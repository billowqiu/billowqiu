<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="taocoding">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="taocoding">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="taocoding">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/">





  <title>taocoding</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d13234060d812cb98a47e937139083a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">taocoding</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2012/07/20/c会提供标准的网络库？/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/07/20/c会提供标准的网络库？/" itemprop="url">C++会提供标准的网络库？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-07-20T12:42:39+08:00">
                2012-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2005年即提出的TR2中有提到下面几个议题：</p>
<ul>
<li>Unicode</li>
<li>XML and HTML</li>
<li>Networking</li>
<li>Usability for novices and occasional programmers<br>后来在05年和07年分别有两个Networking Library Proposal for TR2，参加以下链接</li>
</ul>
<p><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1925.pdf" target="_blank" rel="noopener">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1925.pdf</a><br><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2175.pdf(其实就是asio)" target="_blank" rel="noopener">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2175.pdf(其实就是asio)</a></p>
<p>去年C++11终于发布，TR1中很多库也是顺利进入标准，今年年初asio作者又搞了报告</p>
<p><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3360.pdf" target="_blank" rel="noopener">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3360.pdf</a></p>
<p>不知道最终asio是否会进入标准库。</p>
<p>从<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3374.htm" target="_blank" rel="noopener">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3374.htm</a>可以了解到，今年10月会在波兰搞个网络相关统一议案，不知道那时C++网络库会不会有个大致的轮廓，坐等吧。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2012/07/08/scons概览/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/07/08/scons概览/" itemprop="url">SCons基本概念</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-07-08T22:30:03+08:00">
                2012-07-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>SCons环境</strong>当SCons开始构建工程，它会创建一个自己的环境，这个环境包括工程依赖关系树，帮助函数，创建者和一些其他的工具。这个环境一部分在内存中创建，另外一些存储到磁盘以便下次构建时加速。这个是SCons的环境，不同于使用Makefile的用户理解的系统环境。</p>
<p><strong>系统环境</strong>是一个类似操作系统的环境容器，包括PATH,HOME等变量。通常可以通过os.environ在Python中获取，因此在SCons也是如此。SCons没有隐式导入任何系统环境设置(例如编译器选项，工具路径等)，因为它被设计为行为可预见的跨平台工具。这也是为什么如果依赖一些系统环境变量，你必须自己通过SCons脚本隐式获取。</p>
<p><strong>SConsturc</strong>是SCons执行的主脚本名，处理即从它开始。</p>
<p><strong>SConscript</strong>也是SCons执行的脚本，只不过是放到工程的子目录。这些文件主要是为了进行分层级的编译，通过放在工程根目录的SConstruct包含。</p>
<p><strong>Builder</strong>是一个SCons对象，你可以显式调用它在一系列源文件中指定编译依赖目标。SCons的威力是依赖关系会自动的被跟踪，当源文件更改后，系统会自动探测哪些目标需要重新构建。</p>
<p><strong>SCanner</strong>另外一个SCons对象。它可以扫描额外依赖的源文件，这些依赖的文件不会被作为Builder的源文件编译。</p>
<p><strong>Tool</strong>是任何扩展Builders，Scanners，和其他有助于SCons环境的外部组件，SCons通过扫描一些目标位置来寻找工具，这些工具可以是工程特定，也可以通过自己安装来扩展核心功能的。</p>
<p>原文为<a href="http://www.scons.org/wiki/BasicConcepts" target="_blank" rel="noopener">http://www.scons.org/wiki/BasicConcepts</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2012/06/22/准备把csdn文章导出了/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2012/06/22/准备把csdn文章导出了/" itemprop="url">准备把csdn文章导出了</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2012-06-22T15:12:18+08:00">
                2012-06-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/生活轨迹/" itemprop="url" rel="index">
                    <span itemprop="name">生活轨迹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>终于整了个主机玩玩，拖了这么久，不容易啊。</p>
<p>折腾了2个小时，终于把以前在csdn的所有文章都搬过来了，第一次搞这些玩意，不容易啊，O(∩_∩)O哈哈~，以后又可以瞎写点东西了。多谢了<a href="http://nick.luckygarden.org/?p=250" target="_blank" rel="noopener">http://nick.luckygarden.org/?p=250</a>这篇博文，有空整理下搬迁过程，睡觉，明天还得去刷钱，端午节快乐。</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/08/07/orm-object-relational-mapping/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/08/07/orm-object-relational-mapping/" itemprop="url">ORM-Object-Relational Mapping</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-08-07T00:00:00+08:00">
                2011-08-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/未分类/" itemprop="url" rel="index">
                    <span itemprop="name">未分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记得去年初的时候，想研究下如何处理好数据库操作代码，当时看到过这个词，不过那会没有深入研究下去，刚刚闲逛中发现两款开源项目，留个记号。</p>
<p><a href="http://sourceforge.net/apps/trac/litesql" target="_blank" rel="noopener">http://sourceforge.net/apps/trac/litesql</a></p>
<p><a href="http://www.codesynthesis.com/products/odb/" target="_blank" rel="noopener">http://www.codesynthesis.com/products/odb/</a></p>
<p>还有个依赖Qt的QxOrm，CodeProject上面有介绍。</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/07/20/c对象内存结构之虚指针/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/07/20/c对象内存结构之虚指针/" itemprop="url">C++对象内存结构之虚指针</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-07-20T22:28:00+08:00">
                2011-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>虚函数对于C++进行OO的作用毋庸置疑，下面通过一个简单的实例对虚指针进行深入讲解</p>
<p><pre class="brush:cpp">#include &lt;cstring&gt;<br>class VirtualClass<br>{<br>public:<br>   virtual void foo()<br>   {<br>   }<br>};</pre></p>
<p>class NoVirtualClass<br>{<br>public:<br>   void foo()<br>  {<br>  }<br>};</p>
<p>int main(int, char <em>[])<br>{<br>    NoVirtualClass</em>pObjA = new NoVirtualClass;<br>    VirtualClassobj;<br>    VirtualClass*pObjB = new VirtualClass;</p>
<pre><code>size_t nNoVirtual = sizeof(NoVirtualClass);
size_t nVirtual = sizeof(VirtualClass);

std::memset( pObjA, 0, nNoVirtual );
std::memset( &amp;amp;obj, 0, nVirtual );
std::memset( pObjB, 0, nVirtual );

pObjA-&amp;gt;foo();
obj.foo();
pObjB-&amp;gt;foo();

return 0;
</code></pre><p>}<br>类NoVirtualClass的大小为1，《深度搜索C++对象模型》有解释，类VirtualClass大小为4，因为对于有virtual函数的C++类，每个对象都有个叫做vfptr的指针，在VS2008中调试上述代码可以看到如下信息：</p>
<p>-__vfptr0x00415740 const VirtualClass::`vftable’<em><br>[0]0x00411104 VirtualClass::foo(void)</em></p>
<p>上面的三个memset分别进行如下操作：</p>
<p>30行那个将pObjA所指的内存区域置0，也就是将其所指的那一个字节清零。</p>
<p>31和32行都是将__vfptr置空。</p>
<p>下面三个函数调用，就很有意思了，尤其是第三个调用，直接出现内存违例。</p>
<p>大家可以把上述代码放到VS中调试跟踪一把，肯定会让自己对C++内存对象模型以及虚函数指针有一个更深的理解。</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/06/01/c版大数相加：字符串实现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/06/01/c版大数相加：字符串实现/" itemprop="url">C++版大数相加：字符串实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-06-01T23:15:00+08:00">
                2011-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>所以大数即，一般的整数类型无法直接表示，通常即通过字符串表示，下面是用c++字符串实现相加，比较粗糙，但大致原理应该是表述清楚了：</p>
<pre class="brush:cpp">std::string stringAdd( const std::string&amp; strLeft, const std::string&amp; strRight )
{
    //结果最长为较长数字加1
    int nLeftLength = strLeft.length();
    int nRigthLength = strRight.length();
    int nLargeLength = nLeftLength &gt;= nRigthLength ? nLeftLength : nRigthLength;
    std::string strResult( nLargeLength+1, &#39;0&#39; );
    int nCount = 0;
    while( nLargeLength )
    {
        char nTempLeft;
        if( nLeftLength )
        {
            nTempLeft = strLeft[--nLeftLength];
        }
        else
        {
            nTempLeft = &#39;0&#39;;
        }
        cout &lt;&lt; &quot;tempLeft:&quot; &lt;&lt; nTempLeft &lt;&lt; std::endl;
        char nTempRigth;
        if( nRigthLength )
        {
            nTempRigth = strRight[--nRigthLength];
        }
        else
        {
            nTempRigth = &#39;0&#39;;
        }
        cout &lt;&lt; &quot;tempRight:&quot; &lt;&lt; nTempRigth &lt;&lt; std::endl;
        //计算当前位的值
        int nTemp = nTempLeft-&#39;0&#39; + nTempRigth-&#39;0&#39; + strResult[nLargeLength]-&#39;0&#39;;
        cout &lt;&lt; &quot;temp:&quot; &lt;&lt; nTemp &lt;&lt; std::endl;
        strResult[nLargeLength] = (nTemp%10)+&#39;0&#39;;
        cout &lt;&lt; &quot;nLargeLength:&quot; &lt;&lt; nLargeLength &lt;&lt; std::endl;
        //如果超过了10则应进1
        if( nTemp &gt;= 10 )
        {
            strResult[nLargeLength-1] = 1+&#39;0&#39;;
        }
        nLargeLength--;
    }
    return strResult;
}</pre>

<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/04/30/主备切换之state模式实现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/04/30/主备切换之state模式实现/" itemprop="url">主备切换之State模式实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-04-30T00:53:00+08:00">
                2011-04-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近项目中需要实现一个主备切换的功能，通过分析可以得出也就两个状态的切换，使用if/switch之类的语句可以轻松搞定，但是为了学习并实践State模式，这里采取了一个State模式的实现：</p>
<p><pre class="brush:cpp">// HAState.h: interface for the HAState class.<br>//<br>//////////////////////////////////////////////////////////////////////</pre></p>
<p>#if !defined(AFX_HASTATE_H__410262B3_3FEB_44B3_BFA7_04C4BEBCE636__INCLUDED_)</p>
<p>#define AFX_HASTATE_H__410262B3_3FEB_44B3_BFA7_04C4BEBCE636__INCLUDED_</p>
<p>#if _MSC_VER &gt; 1000</p>
<p>#pragma once</p>
<p>#endif // _MSC_VER &gt; 1000</p>
<p>#include &lt;iostream&gt;<br>class HASwitch;<br>enum HASTATE<br>{<br>    STANDBY,<br>    PRIMARY,<br>    FAILURE<br>};<br>class HAState<br>{<br>public:<br>    HAState();<br>    virtual ~HAState();</p>
<pre><code>virtual HASTATE getState();
virtual bool standby2primary( HASwitch* pSwitch ) = 0;
virtual bool primary2standby( HASwitch* pSwitch ) = 0;
</code></pre><p>protected:<br>    void changeState( HASwitch<em> pSwitch, HAState</em> pNewState );<br>protected:<br>    HASTATE m_euState;<br>};</p>
<p>#endif // !defined(AFX_HASTATE_H__410262B3_3FEB_44B3_BFA7_04C4BEBCE636__INCLUDED_)<br>// HAState.cpp: implementation of the HAState class.<br>//<br>//////////////////////////////////////////////////////////////////////</p>
<p>#include “HAState.h”</p>
<p>#include “HASwitch.h”<br>//////////////////////////////////////////////////////////////////////<br>// Construction/Destruction<br>//////////////////////////////////////////////////////////////////////<br>HAState::HAState():m_euState( FAILURE )<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>}<br>HAState::~HAState()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>}<br>void HAState::changeState( HASwitch<em> pSwitch, HAState</em> pNewState )<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    pSwitch-&gt;changeState( pNewState );<br>}<br>HASTATE HAState::getState()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    return m_euState;<br>}<br>&nbsp;</p>
<p><pre class="brush:cpp">// PrimaryState.h: interface for the PrimaryState class.<br>//<br>//////////////////////////////////////////////////////////////////////</pre></p>
<p>#if !defined(AFX_PRIMARYSTATE_H__DFA509B1_9344_4750_A582_5637A65DF2A8__INCLUDED_)</p>
<p>#define AFX_PRIMARYSTATE_H__DFA509B1_9344_4750_A582_5637A65DF2A8__INCLUDED_</p>
<p>#if _MSC_VER &gt; 1000</p>
<p>#pragma once</p>
<p>#endif // _MSC_VER &gt; 1000</p>
<p>#include &lt;boost/noncopyable.hpp&gt;</p>
<p>#include “HAState.h”<br>class PrimaryState : public HAState, public boost::noncopyable<br>{<br>public:<br>    PrimaryState();<br>    virtual ~PrimaryState();<br>    static PrimaryState&amp; instance();<br>    virtual bool standby2primary( HASwitch<em> pSwitch ) ;<br>    virtual bool primary2standby( HASwitch</em> pSwitch ) ;<br>private:<br>    static PrimaryState s_Instance;<br>};</p>
<p>#endif // !defined(AFX_PRIMARYSTATE_H__DFA509B1_9344_4750_A582_5637A65DF2A8__INCLUDED_)<br>&nbsp;</p>
<p><pre class="brush:cpp">// PrimaryState.cpp: implementation of the PrimaryState class.<br>//<br>//////////////////////////////////////////////////////////////////////</pre></p>
<p>#include “PrimaryState.h”</p>
<p>#include “StandbyState.h”</p>
<p>#include “HASwitch.h”<br>//////////////////////////////////////////////////////////////////////<br>// Construction/Destruction<br>//////////////////////////////////////////////////////////////////////<br>PrimaryState PrimaryState::s_Instance;<br>PrimaryState::PrimaryState()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    m_euState = PRIMARY;<br>}<br>PrimaryState::~PrimaryState()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>}<br>bool PrimaryState::standby2primary( HASwitch* pSwitch )<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    std::cout &lt;&lt; “Current state is already primary” &lt;&lt; std::endl;</p>
<pre><code>return true;
</code></pre><p>}<br>bool PrimaryState::primary2standby( HASwitch* pSwitch )<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    std::cout &lt;&lt; “Begin switch to standby…” &lt;&lt; std::endl;</p>
<pre><code>std::cout &amp;lt;&amp;lt; &quot;Do something&quot; &amp;lt;&amp;lt; std::endl;
changeState( pSwitch, &amp;amp;StandbyState::instance() );

std::cout &amp;lt;&amp;lt; &quot;End switch to standby...&quot; &amp;lt;&amp;lt; std::endl;

return true;
</code></pre><p>}<br>PrimaryState&amp; PrimaryState::instance()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    return s_Instance;<br>}<br>// StandbyState.h: interface for the StandbyState class.<br>//<br>//////////////////////////////////////////////////////////////////////</p>
<p>#if !defined(AFX_STANDBYSTATE_H__028C47F8_1A92_4854_A93D_2AECB6A17DF6__INCLUDED_)</p>
<p>#define AFX_STANDBYSTATE_H__028C47F8_1A92_4854_A93D_2AECB6A17DF6__INCLUDED_</p>
<p>#if _MSC_VER &gt; 1000</p>
<p>#pragma once</p>
<p>#endif // _MSC_VER &gt; 1000</p>
<p>#include &lt;boost/noncopyable.hpp&gt;</p>
<p>#include “HAState.h”<br>class StandbyState : public HAState, public boost::noncopyable<br>{<br>public:<br>    StandbyState();<br>    virtual ~StandbyState();<br>    static StandbyState&amp; instance();<br>    virtual bool standby2primary( HASwitch<em> pSwitch ) ;<br>    virtual bool primary2standby( HASwitch</em> pSwitch ) ;<br>private:<br>    static StandbyState s_Instance;<br>};</p>
<p>#endif // !defined(AFX_STANDBYSTATE_H__028C47F8_1A92_4854_A93D_2AECB6A17DF6__INCLUDED_)<br>// StandbyState.cpp: implementation of the StandbyState class.<br>//<br>//////////////////////////////////////////////////////////////////////</p>
<p>#include “StandbyState.h”</p>
<p>#include “PrimaryState.h”</p>
<p>#include “HASwitch.h”<br>//////////////////////////////////////////////////////////////////////<br>// Construction/Destruction<br>//////////////////////////////////////////////////////////////////////<br>StandbyState StandbyState::s_Instance;<br>StandbyState::StandbyState()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    m_euState = STANDBY;<br>}<br>StandbyState::~StandbyState()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>}<br>bool StandbyState::standby2primary( HASwitch* pSwitch )<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    std::cout &lt;&lt; “Begin switch to primary…” &lt;&lt; std::endl;</p>
<pre><code>std::cout &amp;lt;&amp;lt; &quot;Do something&quot; &amp;lt;&amp;lt; std::endl;
changeState( pSwitch, &amp;amp;PrimaryState::instance() );

std::cout &amp;lt;&amp;lt; &quot;End switch to primary...&quot; &amp;lt;&amp;lt; std::endl;

return true;
</code></pre><p>}<br>bool StandbyState::primary2standby( HASwitch* pSwitch )<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    std::cout &lt;&lt; “Current state is already standby” &lt;&lt; std::endl;</p>
<pre><code>return true;
</code></pre><p>}<br>StandbyState&amp; StandbyState::instance()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    return s_Instance;<br>}<br>// HASwitch.h: interface for the HASwitch class.<br>//<br>//////////////////////////////////////////////////////////////////////</p>
<p>#if !defined(AFX_HASWITCH_H__AC109E28_51E4_46AE_BC07_9E93FA747B65__INCLUDED_)</p>
<p>#define AFX_HASWITCH_H__AC109E28_51E4_46AE_BC07_9E93FA747B65__INCLUDED_</p>
<p>#if _MSC_VER &gt; 1000</p>
<p>#pragma once</p>
<p>#endif // _MSC_VER &gt; 1000</p>
<p>#include &lt;boost/noncopyable.hpp&gt;</p>
<p>#include “HAState.h”<br>class HASwitch : public boost::noncopyable<br>{<br>    friend class HAState;<br>public:<br>    HASwitch();<br>    virtual ~HASwitch();<br>    static HASwitch&amp; instance();<br>    HASTATE getState() const;<br>    boolstandby2primary();<br>    boolprimary2standby();<br>private:<br>    void changeState( HAState<em> pNewState );<br>private:<br>    static HASwitch g_Instance;<br>    HAState</em> m_pCurState;<br>};</p>
<p>#endif // !defined(AFX_HASWITCH_H__AC109E28_51E4_46AE_BC07_9E93FA747B65__INCLUDED_)<br>&nbsp;</p>
<p><pre class="brush:cpp">// HASwitch.cpp: implementation of the HASwitch class.<br>//<br>//////////////////////////////////////////////////////////////////////</pre></p>
<p>#include “HASwitch.h”</p>
<p>#include “HAState.h”</p>
<p>#include “PrimaryState.h”</p>
<p>#include “StandbyState.h”<br>//////////////////////////////////////////////////////////////////////<br>// Construction/Destruction<br>//////////////////////////////////////////////////////////////////////<br>HASwitch HASwitch::g_Instance;<br>HASwitch::HASwitch()<br>{<br>    m_pCurState = &amp;StandbyState::instance();<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>}<br>HASwitch::~HASwitch()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>}<br>HASTATE HASwitch::getState() const<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    return m_pCurState-&gt;getState();<br>}<br>bool HASwitch::standby2primary()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    return m_pCurState-&gt;standby2primary(this);<br>}<br>bool HASwitch::primary2standby()<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    return m_pCurState-&gt;primary2standby(this);<br>}<br>void HASwitch::changeState( HAState* pNewState )<br>{<br>    std::cout &lt;&lt; “Call “ &lt;&lt; <strong>FUNCTION</strong> &lt;&lt; std::endl;<br>    m_pCurState = pNewState;<br>}<br>HASwitch&amp; HASwitch::instance()<br>{<br>    return g_Instance;<br>}<br>测试代码：</p>
<p><pre class="brush:cpp">#include &lt;iostream&gt;</pre></p>
<p>#include &lt;assert.h&gt;</p>
<p>#include “HASwitch.h”<br>int main(int argc , char ** argv)<br>{<br>    assert( HASwitch::instance().getState() == STANDBY );<br>    HASwitch::instance().standby2primary();<br>    assert( HASwitch::instance().getState() == PRIMARY );<br>    HASwitch::instance().primary2standby();<br>    assert( HASwitch::instance().getState() == STANDBY );<br>    return 0;<br>}<br>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/04/17/thrift之hello-python-client-cpp-sever/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/04/17/thrift之hello-python-client-cpp-sever/" itemprop="url">thrift之Hello</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-04-17T23:35:00+08:00">
                2011-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/系统编程/" itemprop="url" rel="index">
                    <span itemprop="name">系统编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Thrift是一个开发跨语言服务的软件框架。编写thrift文件，通过自带的代码生成引擎即可生成各种语言(C++，Java，Python，PHP，Ruby，Erlang，C#等)的对应代码，下面以最经典的hello为例讲述，如何通过thrift编写跨语言的RPC程序：<br>1编写thrift文件，保存为hello.thrift：</p>
<p><pre class="brush:cpp">service Hello<br>{<br>    void Hello()<br>}</pre><br>2生成cpp和py框架文件<br>在hello.thrift文件所在目录执行：<br>thrift -r –gen cpp hello.thrift<br>thrift -r –gen py hello.thrift<br>会在当前目录下面产生两个文件夹，分别为gen-cpp和gen-py，<br>3编写cpp服务器端代码，拷贝gen-cpp目录中的Hello_server.skeleton.cpp到当前目录，重命名为CppServer.cpp，修改如下：</p>
<p><pre class="brush:cpp">#include “Hello.h”</pre></p>
<p>#include &lt;protocol/TBinaryProtocol.h&gt; </p>
<p>#include &lt;server/TSimpleServer.h&gt;</p>
<p>#include &lt;transport/TServerSocket.h&gt; </p>
<p>#include &lt;transport/TBufferTransports.h&gt; </p>
<p>using namespace ::apache::thrift;<br>using namespace ::apache::thrift::protocol;<br>using namespace ::apache::thrift::transport;<br>using namespace ::apache::thrift::server;<br>using boost::shared_ptr;<br>class HelloHandler : virtual public HelloIf<br>{<br>public:<br>HelloHandler()<br>{<br>// Your initialization goes here<br>}<br>void Hello()<br>{<br>   // Your implementation goes here<br>    printf(“Hello,Thrift/n”);<br>}<br>};<br>int main(int argc, char **argv)<br>{<br>    int port = 9090;<br>    shared_ptr handler(new HelloHandler());<br>    shared_ptr processor(new HelloProcessor(handler));<br>    shared_ptr serverTransport(new TServerSocket(port));<br>    shared_ptr transportFactory(new TBufferedTransportFactory());<br>    shared_ptr protocolFactory(new TBinaryProtocolFactory());<br>    TSimpleServer server(processor, serverTransport, transportFactory, protocolFactory);</p>
<pre><code>server.serve();

return 0;
</code></pre><p>}<br>4编写python客户端代码，PythonClient.py如下：</p>
<p><pre class="brush:python">#!/usr/bin/env python<br>import sys<br>sys.path.append(‘./gen-py’)<br>from hello import Hello<br>from hello.ttypes import *<br>from thrift import Thrift<br>from thrift.transport import TSocket<br>from thrift.transport import TTransport<br>from thrift.protocol import TBinaryProtocol</pre></p>
<h1 id="Make-socket"><a href="#Make-socket" class="headerlink" title="Make socket"></a>Make socket</h1><p>transport = TSocket.TSocket(‘localhost’, 9090)</p>
<h1 id="Buffering-is-critical-Raw-sockets-are-very-slow"><a href="#Buffering-is-critical-Raw-sockets-are-very-slow" class="headerlink" title="Buffering is critical. Raw sockets are very slow"></a>Buffering is critical. Raw sockets are very slow</h1><p>transport = TTransport.TBufferedTransport(transport)</p>
<h1 id="Wrap-in-a-protocol"><a href="#Wrap-in-a-protocol" class="headerlink" title="Wrap in a protocol"></a>Wrap in a protocol</h1><p>protocol = TBinaryProtocol.TBinaryProtocol(transport)</p>
<h1 id="Create-a-client-to-use-the-protocol-encoder"><a href="#Create-a-client-to-use-the-protocol-encoder" class="headerlink" title="Create a client to use the protocol encoder"></a>Create a client to use the protocol encoder</h1><p>client = Hello.Client(protocol)</p>
<h1 id="Connect"><a href="#Connect" class="headerlink" title="Connect!"></a>Connect!</h1><p>transport.open()</p>
<h1 id="Call-Server-services"><a href="#Call-Server-services" class="headerlink" title="Call Server services"></a>Call Server services</h1><p>client.Hello()<br>5编写cpp端Makefile如下：</p>
<p><pre class="brush:bash">BOOST_DIR = /usr/local/include/boost/<br>THRIFT_DIR = /usr/local/include/thrift<br>LIB_DIR = /usr/local/lib<br>GEN_SRC = ./gen-cpp/hello_types.cpp ./gen-cpp/Hello.cpp<br>default: server<br>server: CppServer.cpp<br>g++ -o CppServer -I${THRIFT_DIR} -I${BOOST_DIR} -I./gen-cpp -L${LIB_DIR} -lthrift CppServer.cpp ${GEN_SRC}<br>clean:<br>$(RM) -r CppServer</pre><br>6编译cpp端，直接make即可生成相应的可执行文件，python端可以直接运行。</p>
<p>至此一个最简单的跨语言PRC程序即完成了，很简单吧。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/04/16/centos5-5下scribe写入数据到hdfs配置方法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/04/16/centos5-5下scribe写入数据到hdfs配置方法/" itemprop="url">CentOS5.5下scribe写入数据到HDFS配置方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-04-16T01:55:00+08:00">
                2011-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/系统编程/" itemprop="url" rel="index">
                    <span itemprop="name">系统编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1按照<a href="http://blog.csdn.net/ToCpp/archive/2011/04/10/6314374.aspx" target="_blank" rel="noopener">CentOS 5.5 下配置Hadoop 0.21单节点</a><br>一文中的方法配置Hadoop</p>
<p>2编译scribe，支持hdfs<br>2.1下载thrift,libevent,boost等库，可以都下载最新版本，基本上都是make &amp; make install<br>2.2下载最新版scribe-2.2，之前在网上看到说scribe有很多bug，必须在当前开发版本才能写入HDFS，试了好久没成功，也以为确实是代码的问题，现在发现不是这个问题，直接<a href="https://github.com/facebook/scribe" target="_blank" rel="noopener">下载</a>该版本<br>2.3在scribe源码包里面bootstrap.sh，按照文档上的说法是可以一步到位的即</p>
<p>./configure CPPFLAGS=”-DHAVE_INTTYPES_H -DHAVE_NETINET_IN_H -I/data/billowqiu/jdk1.6.0_25/include -I/data/billowqiu/jdk1.6.0_25/include/linux -I/data/billowqiu/hadoop-0.20.1+169.89/src/c++/libhdfs” LDFLAGS=”-L/data/billowqiu/hadoop-0.20.1+169.89/src/c++/libhdfs/lib -L/data/billowqiu/jdk1.6.0_25/jre/lib/amd64/server” –with-hadooppath=/data/billowqiu/hadoop-0.20.1+169.89 –enable-hdfs，实在不行直接修改Makefile也可以，先./configure –enable-hdfs，然后修改相应的src目录下面的Makefile，将以下字段修改如下：CPPFLAGS = -I/usr/local/lib/jdk1.6.0_23/include -I/usr/local/lib/jdk1.6.0_23/include/linux</p>
<p>上面的JDK路径以机器上面的实际路径为准。</p>
<p>貌似在静态链接boost会出现“undefined reference to `boost::system::generic_category()”，通过将将-lboost_system -lboost_filesystem放到链接库最后可以解决。</p>
<p>$ cd src $ g++ -Wall -O3 -L/usr/lib -o scribed store.o store_queue.o conf.o file.o conn_pool.o scribe_server.o network_dynamic_config.o dynamic_bucket_updater.o env_default.o -L/usr/local/lib -L/usr/local/lib -L/usr/local/lib -lfb303 -lthrift -lthriftnb -levent -lpthread libscribe.a libdynamicbucketupdater.a -lboost_system -lboost_filesystem</p>
<p>&nbsp;</p>
<p>2.4拷贝hadoop-0.21.0/hdfs/src/c++/libhdfs/hdfs.h文件到scribe/src目录下，libhdfs其实就是通过JNI让C/C++调用HDFS接口，在hadoop-0.21.0/hdfs/src/c++/libhdfs目录下面执行如下操作<br>./configure –enable-shared JVM_ARCH=tune=k8 –prefix=<code>pwd</code>/nativelib<br>./make install<br>这时会在nativelib/lib下面生成5个文件，将其都拷贝到/usr/local/lib下面，执行ldconfig<br>2.5编译scribe，在scribe/src目录下面执行./make，即可生成scribed文件，<br>2.6按照scribe/examples目录下面的配置文件写个简单的支持HDFS的配置文件simple_hdfs_example.conf：<br>port=1463<br>max_msg_per_second=2000000<br>check_interval=1<br>max_queue_size=100000000<br>num_thrift_server_threads=2</p>
<h1 id="DEFAULT-write-all-messages-to-hadoop"><a href="#DEFAULT-write-all-messages-to-hadoop" class="headerlink" title="DEFAULT - write all messages to hadoop"></a>DEFAULT - write all messages to hadoop</h1><p>&lt;store&gt;<br>category=default<br>target_write_size=20480<br>type=file<br>fs_type=hdfs<br>file_path=hdfs://localhost:9000/scribedata<br>create_symlink=no<br>use_hostname_sub_directory=yes<br>base_filename=thisisoverwritten<br>max_size=1000000000<br>rotate_period=100s<br>add_newlines=1<br>&lt;/store&gt;<br>&lt;store&gt;<br>category=qt<br>target_write_size=20480<br>type=file<br>fs_type=hdfs<br>file_path=hdfs://localhost:9000/scribedata<br>create_symlink=no<br>use_hostname_sub_directory=yes<br>base_filename=thisisoverwritten<br>max_size=1000000000<br>rotate_period=100s<br>add_newlines=1<br>&lt;/store&gt;<br>2.7到处libhdfs库需要使用的jar路径即CLASSPATH，具体需要哪些不太清楚，<br>官方文档上建议将hadoop/lib目录下所有的库的加入，下面是我导出的：<br>export CLASSPATH=$CLASSPATH:/xxx/hadoop-0.21.0/hadoop-common-0.21.0.jar:/xxx/hadoop-0.21.0/hadoop-hdfs-0.21.0.jar:/xxx/hadoop-0.20.1+152/contrib/scribe-log4j/hadoop-0.20.1+152-scribe-log4j.jar:/xxx/hadoop-0.21.0/lib/commons-logging-1.1.1.jar:/xxx/hadoop-0.21.0/lib/commons-logging-api-1.1.jar:/xxx/hadoop-0.21.0/lib/core-3.1.1.jar:/xxx/hadoop-0.21.0/lib/log4j-1.2.15.jar<br>XXX你懂的。</p>
<p>2.8可以执行scribe了， ./scribed ../examples/simple_hdfs_example.conf<br>2.9通过发送工具发送日志到scribe，echo “Successful write data to HDFS,I am qiutao” | ./scribe_cat qt<br>3.10在hadoop目录下面执行bin/hadoop dfs -lsr /scribedata即可看到相应的数据生成了。<br>整个过程确实比较繁琐，尤其要注意2.4，一定要在自己机器上面编译libhdfs库，否则会出现一些莫名其妙的问题，<br>基本上都是抛出的java异常，在这个上面吃了不少亏，终于在自己机器上面写入HDFS了，一步步的也学到了不少东西，<br>留作以后备用。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2011/04/15/thrift安装记录/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2011/04/15/thrift安装记录/" itemprop="url">thrift安装记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2011-04-15T12:30:05+08:00">
                2011-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/C/系统编程/" itemprop="url" rel="index">
                    <span itemprop="name">系统编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>thrift依赖boost，libevent，openssl等</p>
<p>前两者都用默认安装即可，openssl安装时需要注意使用如下配置选项：</p>
<p>./config –prefix=/usr/local/ shared，否则会导致thrift在configure时出现依赖ssl或者crypto错误，折腾了半天，记录下。</p>
<p>另外在thrift配置时主要使用以下选项，以包含相应文件：</p>
<p>./configure CPPFLAGS=”-DHAVE_INTTYPES_H -DHAVE_NETINET_IN_H”</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">billowqiu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">153</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/billowqiu" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:billowqiu@163.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">billowqiu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
