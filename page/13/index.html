<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="taocoding">
<meta property="og:url" content="http://yoursite.com/page/13/index.html">
<meta property="og:site_name" content="taocoding">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="taocoding">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/13/">





  <title>taocoding</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d13234060d812cb98a47e937139083a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">taocoding</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/08/14/在vc2005-express中使用wtl/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/08/14/在vc2005-express中使用wtl/" itemprop="url">在VC2005 Express中使用WTL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-08-14T12:12:00+08:00">
                2008-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/VC/" itemprop="url" rel="index">
                    <span itemprop="name">VC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>废话不多说，搞了一上午了，</p>
<p>安装VC2005Express，先下PSDK，注意安装的时候要记得安那个Web WorkShop SDK，否则编译的时候会先提示Shlwapi.h这个文件，其他需要注意的就是CodeProject上那个日本哥们写的<a href="http://www.codeproject.com/KB/wtl/WTLExpress.aspx" target="_blank" rel="noopener"><u><font color="#0000ff">http://www.codeproject.com/KB/wtl/WTLExpress.aspx</font></u></a>，写的不错，只要安这个步骤，应该不会错的，主要是那个在VC2005Express下设置PSDK，它妈的真服了MS，VC2005Express默认都不让生成Win32工程，还要按照那个挂掉的链接说明设置，找了半天没找到那个链接的相关内容，搞得累了一上午，最后终于google到了，竟然还要改工程默认配置文件，终于搞定了，为了以后设置方便这里把那篇E文Copy了：</p>
<font size="3"><a href="http://msdn.microsoft.com/vstudio/express/visualc/usingpsdk/" target="_blank" rel="noopener">http://msdn.microsoft.com/vstudio/express/visualc/usingpsdk/</a><br>Using Visual C++ 2005 Express Edition with the Microsoft Platform SDK<br>By Brian Johnson,<br>Microsoft Corporation<br>You can use Visual C++ Express to build powerful .NET Framework applications immediately after installation. In order to use Visual C++ Express to build Win32 applications, you’ll need to take just a few more steps. I’ll list the steps necessary for building Win32 applications using Visual C++ Express.<br>Step 1: Install Visual C++ Express.<br>If you haven’t done so already, install Visual C++ Express.<br><br>Step 2: Install the Microsoft Platform SDK.<br>Install the Platform SDK over the Web from the Download Center. Follow the instructions and install the SDK for the x86 platform.<br><br>Step 3: Update the Visual C++ directories in the Projects and Solutions section in the Options dialog box.<br>Add the paths to the appropriate subsection:<br>Executable files: C:/Program Files/Microsoft Platform SDK for Windows Server 2003 R2/Bin<br>Include files: C:/Program Files/Microsoft Platform SDK for Windows Server 2003 R2/Include<br>Library files: C:/Program Files/Microsoft Platform SDK for Windows Server 2003 R2/Lib<br>Note: Alternatively, you can update the Visual C++ Directories by modifying the VCProjectEngine.dll.express.config file located in the /vc/vcpackages subdirectory of the Visual C++ Express install location. Please make sure that you also delete the file “vccomponents.dat” located in the “%USERPROFILE%/Local Settings/Application Data/Microsoft/VCExpress/8.0” if it exists before restarting Visual C++ Express Edition.<br><br>Step 4: Update the corewin_express.vsprops file.<br>One more step is needed to make the Win32 template work in Visual C++ Express. You need to edit the corewin_express.vsprops file (found in C:/Program Files/Microsoft Visual Studio 8/VC/VCProjectDefaults) and<br>Change the string that reads:<br>AdditionalDependencies=”kernel32.lib” to<br>AdditionalDependencies=”kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib”<br><br>Step 5: Generate and build a Win32 application to test your paths.<br>In Visual C++ Express, the Win32 Windows Application type is disabled in the Win32 Application Wizard. To enable that type, you need to edit the file AppSettings.htm file located in the folder “%ProgramFiles%/Microsoft Visual Studio 8/VC/VCWizards/AppWiz/Generic/Application/html/1033/“.<br>In a text editor comment out lines 441 - 444 by putting a // in front of them as shown here:<br>// WIN_APP.disabled = true;<br>// WIN_APP_LABEL.disabled = true;<br>// DLL_APP.disabled = true;<br>// DLL_APP_LABEL.disabled = true;<br>Save and close the file and open Visual C++ Express.<br>From the File menu, click New Project. In the New Project dialog box, expand the Visual C++ node in the Product Types tree and then click Win32. Click on the Win32 Console Application template and then give your project a name and click OK. In the Win32 Application Wizard dialog box, make sure that Windows application is selected as the Application type and the ATL is not selected. Click the Finish button to generate the project.<br>As a final step, test your project by clicking the Start button in the IDE or by pressing F5. Your Win32 application should build and run. </font>

<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/07/24/wm-nchittest消息/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/07/24/wm-nchittest消息/" itemprop="url">WM_NCHITTEST消息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-07-24T01:10:00+08:00">
                2008-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/VC/" itemprop="url" rel="index">
                    <span itemprop="name">VC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以SDK为例：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case WM_LBUTTONDOWN :<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pt.x = LOWORD(lParam);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pt.y = HIWORD(lParam);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wsprintf(mess,”pt.x=%d,pt.y=%d”,pt.x,pt.y);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox(hwnd,mess,”调试”,MB_OK);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /<em>ScreenToClient(hwnd,&amp;pt);</em>/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (PtInRect(&amp;rcClose, pt))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox(hwnd,”点击了关闭按钮”,”调试”,MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SendMessage(hwnd,WM_SYSCOMMAND,(WPARAM)SC_CLOSE,(LPARAM)MAKELPARAM(pt.x, pt.y));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (PtInRect(&amp;rcMin, pt))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SendMessage(hwnd,WM_SYSCOMMAND,(WPARAM)SC_MINIMIZE,(LPARAM)MAKELPARAM(pt.x, pt.y));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case WM_NCHITTEST:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pt.x = LOWORD(lParam);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pt.y = HIWORD(lParam);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ScreenToClient(hwnd,&amp;pt);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!PtInRect(&amp;rcClose,pt) &amp;&amp; !PtInRect(&amp;rcMin,pt))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return HTCAPTION;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return HTCLIENT;</p>
<p>当你在消息函数中截获此消息时，你可以选择直接返回相应的值比如HTCAPTION给OS，这时经过我的测试发现OS就不会给你发送WM_LBUTTONDOWN消息了，而如上所示我需要响应WM_LBUTTONDOWN怎么办呢？这时可以通过判断相应点是否在某个区域内返回相应的值，经过测试可以运行。</p>
<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/07/19/映像模式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/07/19/映像模式/" itemprop="url">映像模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-07-19T16:54:00+08:00">
                2008-07-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/VC/" itemprop="url" rel="index">
                    <span itemprop="name">VC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&lt;TABLE style=&quot;TABLE-LAYOUT: fixed&quot;&gt;
</code></pre><p><tbody></tbody></p>
<p><tr></tr></p>
<p><td></td></p>
<p><div class="cnt" id="blog_text">经过一上午的研究，目前的体会是：<br>设备坐标就是你创建出来的窗口那个坐标，其原点始终在(0,0)，即窗口左上角，<br>逻辑坐标就是你GDI函数(绝大部分)中使用的坐标，它是一个虚拟的”窗口”，仅仅为了让你画图方便<br>使用了GDI函数后这里指定的逻辑坐标Windows在实际输出到窗口上时将其转换为设备坐标，这时映像模式派上用途了，<br>设置”窗口”坐标原点(逻辑坐标)方法:<br>1 </div></p>
<p><dl class="code"></dl></p>
<p><dt>C/C++ code </dt></p>
<p><dd><pre><div><span style="COLOR: #000000"><br> CRect rect;<br> GetClientRect (</span><span style="COLOR: #000000">&amp;</span><span style="COLOR: #000000">rect);<br> dc.SetMapMode (MM_LOENGLISH);<br> dc.SetViewportOrg (rect.Width () </span><span style="COLOR: #000000">/</span><span style="COLOR: #000000"> </span><span style="COLOR: #800080">2</span><span style="COLOR: #000000">, rect.Height () </span><span style="COLOR: #000000">/</span><span style="COLOR: #000000"> </span><span style="COLOR: #800080">2</span><span style="COLOR: #000000">);<br></span></div></pre></dd><br>2 </p>
<p><dl class="code"></dl></p>
<p><dt>C/C++ code </dt></p>
<p><dd><pre><div><span style="COLOR: #000000"><br> CRect rect;<br> GetClientRect (</span><span style="COLOR: #000000">&amp;</span><span style="COLOR: #000000">rect);<br> CPoint point (rect.Width () </span><span style="COLOR: #000000">/</span><span style="COLOR: #000000"> </span><span style="COLOR: #800080">2</span><span style="COLOR: #000000">, rect.Height () </span><span style="COLOR: #000000">/</span><span style="COLOR: #000000"> </span><span style="COLOR: #800080">2</span><span style="COLOR: #000000">);<br> dc.SetMapMode (MM_LOENGLISH);<br> dc.DPtoLP (</span><span style="COLOR: #000000">&amp;</span><span style="COLOR: #000000">point);<br> dc.SetWindowOrg (</span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">point.x, </span><span style="COLOR: #000000">-</span><span style="COLOR: #000000">point.y);<br></span></div></pre></dd><br>两种方法都是将”窗口”坐标(逻辑坐标)原点设置为客户区中央，但是需要注意的是在使用SetWindowOrg时坐标值必须是逻辑坐标，因此需要dc.DPtoLP (&amp;point)，而在使用SetViewportOrg时则不需，因为这个函数使用的坐标值是设备坐标值。 </p>
<p>总结：设置逻辑坐标原点用SetViewportOrg最好，其中指定的x,y即是最后逻辑坐标原点的值，在这个基础上使用GDI函数即是。<br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/07/17/多线程学习-使用临界区进行线程同步/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/07/17/多线程学习-使用临界区进行线程同步/" itemprop="url">多线程学习-使用临界区进行线程同步</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-07-17T16:38:00+08:00">
                2008-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/系统编程/" itemprop="url" rel="index">
                    <span itemprop="name">系统编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&amp;nbsp; 
</code></pre><p><table style="TABLE-LAYOUT: fixed"></table></p>
<p><tbody></tbody></p>
<p><tr></tr></p>
<p><td></td></p>
<div class="cnt" id="blog_text"><br><div class="Section0" style="LAYOUT-GRID:  15.6pt none"><br><br><span style="FONT-SIZE: 12pt; mso-spacerun: yes"><font face="宋体">&nbsp;&nbsp;&nbsp; 昨天那个火车站售票系统存在线程同步上的问题，这在实际应用中是不能存在的，否则后果不堪设想，估计上次那个ATM取款机的问题就是由于线程同步引起的。今天看了视频第16讲，知道了互斥，事件等同步对象以及相应的同步函数是可以跨进程使用的，而且一般也是作为不同进程中线程的同步用的，当然在同一个线程中也是可以用的，但是使用稍显麻烦，使用临界区进行同一个进程中的线程同步则简单直观。下面使用临界区来消除卖票系统中的同步问题：</font></span><span style="FONT-SIZE: 12pt; mso-spacerun: yes"></span><br><br><span style="FONT-SIZE: 12pt; mso-spacerun: yes"></span><span style="FONT-SIZE: 12pt; mso-spacerun: yes"></span><br><br><span style="FONT-SIZE: 12pt; mso-spacerun: yes"><font face="宋体"></font></span>&nbsp;<br><span style="FONT-SIZE: 12pt; mso-spacerun: yes"><font face="宋体"><br><div class="highlighter"><br><br></div>

<p><span></span><span style="FONT-SIZE: 12pt; mso-spacerun: yes"></span><br></p></font></span></div></div><br><p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/07/16/多线程学习-线程基本概念及线程创建/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/07/16/多线程学习-线程基本概念及线程创建/" itemprop="url">多线程学习-线程基本概念及线程创建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-07-16T23:19:00+08:00">
                2008-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/系统编程/" itemprop="url" rel="index">
                    <span itemprop="name">系统编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&lt;SPAN style=&quot;FONT-SIZE: 10.5pt; mso-spacerun: yes&quot;&gt;&lt;FONT face=宋体&gt;&lt;FONT face=&quot;Times New Roman&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;/FONT&gt;以前上操作系统时学过一些关于进程，线程以及同步的理论，也在Linux做过一些多线程的实验，但是感觉那些都只是为了应付课程之类的东东，今天看了孙鑫老师的VC视频第15讲，主要讲的线程的创建以及使用互斥对象进行线程同步操作，感觉他这套视频确实是很经典。下面总结一下学习的东西：&lt;/FONT&gt;&lt;/SPAN&gt;&lt;SPAN style=&quot;FONT-SIZE: 10.5pt; mso-spacerun: yes&quot;&gt;&lt;/SPAN&gt;
</code></pre><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">程序是计算机指令的集合，它以文件的形式存储在磁盘上。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">进程</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">：通常被定义为一个正在运行的程序的实例，是一个程序在其自身的地址空间中的一次执行活动。进程是资源申请、调度和独立运行的单位，因此，它使用系统中的运行资源；而程序不能申请系统资源，不能被系统调度，也不能作为独立运行的单位，因此，它不占用系统的运行资源。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">进程由两个部分组成</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">：</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">1<font face="宋体">、操作系统用来管理进程的内核对象。内核对象也是系统用来存放关于进程的统计信息的地方。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">2<font face="宋体">、地址空间。它包含所有可执行模块或DLL模块的代码和数据。它还包含动态内存分配的空间。如线程堆栈和堆分配空间。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">进程是不活泼的。进程从来不执行任何东西，它只是线程的容器。若要使进程完成某项操作，它必须拥有一个在它的环境中运行的线程，此线程负责执行包含在进程的地址空间中的代码。单个进程可能包含若干个线程，这些线程都“同时” 执行进程地址空间中的代码。每个进程至少拥有一个线程，来执行进程的地址空间中的代码。当创建一个进程时，操作系统会自动创建这个进程的第一个线程，称为主线程。此后，该线程可以创建其他的线程。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">线程由两个部分组成</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">：</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">1<font face="宋体">、线程的内核对象，操作系统用它来对线程实施管理。内核对象也是系统用来存放线程统计信息的地方。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">2<font face="宋体">、线程堆栈，它用于维护线程在执行代码时需要的所有参数和局部变量。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">当创建线程时，系统创建一个线程内核对象。该线程内核对象不是线程本身，而是操作系统用来管理线程的较小的数据结构。可以将线程内核对象视为由关于线程的统计信息组成的一个小型数据结构。 </font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">线程总是在某个进程环境中创建。系统从进程的地址空间中分配内存，供线程的堆栈使用。新线程运行的进程环境与创建线程的环境相同。因此，新线程可以访问进程的内核对象的所有句柄、进程中的所有内存和在这个相同的进程中的所有其他线程的堆栈。这使得单个进程中的多个线程确实能够非常容易地互相通信。 </font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">线程只有一个内核对象和一个堆栈，保留的记录很少，因此所需要的内存也很少。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">因为线程需要的开销比进程少，因此在编程中经常采用多线程来解决编程问题，而尽量避免创建新的进程。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">操作系统为每一个运行线程安排一定的CPU时间 —— 时间片。系统通过一种循环的方式为线程提供时间片，线程在自己的时间内运行，因时间片相当短，因此，给用户的感觉，就好像线程是同时运行的一样。如果计算机拥有多个CPU，线程就能真正意义上同时运行了。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">创建线程主要使用API函数CreateThread，在MSDN中的原型声明为：</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">HANDLE</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">CreateThread(</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">&nbsp;&nbsp;</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">LPSECURITY_ATTRIBUTES</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; FONT-STYLE: italic; mso-spacerun: yes">lpThreadAttributes</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">, </span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">&nbsp;&nbsp;</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">SIZE_T</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; FONT-STYLE: italic; mso-spacerun: yes">dwStackSize</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">, </span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">&nbsp;&nbsp;</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">LPTHREAD_START_ROUTINE</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; FONT-STYLE: italic; mso-spacerun: yes">lpStartAddress</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">, </span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">&nbsp;&nbsp;</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">LPVOID</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; FONT-STYLE: italic; mso-spacerun: yes">lpParameter</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">, </span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">&nbsp;&nbsp;</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">DWORD</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; FONT-STYLE: italic; mso-spacerun: yes">dwCreationFlags</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">, </span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">&nbsp;&nbsp;</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">LPDWORD</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; FONT-STYLE: italic; mso-spacerun: yes">lpThreadId</span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-WEIGHT: bold; FONT-SIZE: 10.5pt; mso-spacerun: yes">);</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"> </span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">第一个参数为线程安全属性，一般设置为NULL就可以了；第二个参数是线程使用的堆栈大小，设为0就可以了，表示使用默认的；第三个参数即是线程的起始地址，也就是线程函数；第四个参数是传递给线程函数的参数，一般都会经过case的；第五个参数是线程创建标志，若为CREATE_SUSPENDED表示线程创建后被挂起，需要通过ResumeThread唤醒之，一般设为0表示马上执行；最后一个参数是一个传出参数，表示线程ID。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">可以通过ExitThread来显示终止线程，注意这个函数需要传递线程ID，所以在创建线程时就要记录线程ID，通过CloseHandle可以递减分配给线程的所有内核对象计数。</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体">下面通过视频中的火车站售票系统来说明如何使用CreateThread创建线程，这个例子确实很实用：</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体"></font></span>&nbsp;<br><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><font face="宋体"><br><div class="highlighter"><br><br></div><br><br>代码很简单，需要注意的就是</font></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><strong>CloseHandle并没有终止该线程，只是使该线程的内核对象计数减少</strong>。</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">输入结果截图:</span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"><img src="http://p.blog.csdn.net/images/p_blog_csdn_net/ToCpp/EntryImages/20081002/未命名.jpg" alt=""></span>

<span></span>

<span style="FONT-SIZE: 10.5pt; mso-spacerun: yes">由结果可以看出输出是又问题的，这是因为线程在执行过程中没有进行同步而引起的，后面再介绍解决这个问题的方法。</span><span style="FONT-SIZE: 10.5pt; mso-spacerun: yes"></span>

<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/07/15/两种获取本机ip地址的方法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/07/15/两种获取本机ip地址的方法/" itemprop="url">两种获取本机IP地址的方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-07-15T23:47:00+08:00">
                2008-07-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/系统编程/" itemprop="url" rel="index">
                    <span itemprop="name">系统编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <font size="3">两种方法都是通过先得到主机名再获取IP地址：</font>

<font size="3">The </font><a><strong><font size="3">gethostname</font></strong></a><font size="3"> function retrieves the standard host name for the local computer.</font><br><pre class="syntax"><font size="3"><strong>int</strong> <strong>gethostname(</strong><br>  <strong>char*</strong> <em><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><u><font color="#0000ff">name</font></u></a></em></font><font size="3"><strong>,
</strong>  <strong>int</strong> <em><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><u><font color="#0000ff">namelen</font></u></a></em></font><strong>
</strong><font size="3"><strong>);</strong><br></font></pre><br><div class="reftip" style="VISIBILITY: hidden; OVERFLOW: visible; POSITION: absolute"></div><br><br>#### Parameters<br><br><dl><br><dt><font size="3"><em>name</em> </font><br><dd><font size="3">[out] Pointer to a buffer that receives the local host name. </font><br><dt><font size="3"><em>namelen</em> </font><br><dd><font size="3">[in] Length of the buffer, in bytes&nbsp;&nbsp;&nbsp;&nbsp;</font></dd></dt></dd></dt></dl><br><br><font size="3">char hostname[50];</font>

<font size="3">gethostname（hostname,50);即可得到主机名。有了主机名下一步就是获取IP地址，方法一是通过API函数 gethostbyname，需要注意的事这个函数仅仅适用于IPv4，该函数再MSDN中的注释如下:</font>

<font size="3">The </font><a><strong><font size="3">gethostbyname</font></strong></a><font size="3"> function retrieves host information corresponding to a host name from a host database. </font>

<font size="3"><strong>Note</strong>&nbsp;&nbsp; The </font><a><strong><font size="3">gethostbyname</font></strong></a><font size="3"> function has been deprecated by the introduction of the </font><a href="ms-help://MS.MSDNQTR.v80.chs/MS.MSDN.v80/MS.WIN32COM.v10.en/winsock/winsock/getaddrinfo_2.htm" target="_blank" rel="noopener"><strong><font color="#0000ff" size="3"><u>getaddrinfo</u></font></strong></a><font size="3"> function. Developers creating Windows Sockets 2 applications are urged to use the </font><a><strong><font size="3">getaddrinfo</font></strong></a><font size="3"> function instead of </font><a><strong><font size="3">gethostbyname</font></strong></a><font size="3">.</font>

<pre class="syntax"><font size="3"><strong>struct hostent* FAR</strong> <strong>gethostbyname(</strong><br>  <strong>const char*</strong> <em><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><u><font color="#0000ff">name</font></u></a></em></font><strong><br>**</strong><font size="3">);</font>**</pre>

<font size="3">通过传递主机名得到的返回值是一个hosten结构体指针，</font><br><pre class="syntax"><font size="3">typedef struct hostent {<br>  char FAR<em> </em></font><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><font color="#0000ff" size="3"><u>h_name</u></font></a><font size="3">;<br>  char FAR  FAR<strong> </strong></font><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><font color="#0000ff" size="3"><u>h_aliases</u></font></a><font size="3">;<br>  short </font><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><font color="#0000ff" size="3"><u>h_addrtype</u></font></a><font size="3">;<br>  short </font><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><font color="#0000ff" size="3"><u>h_length</u></font></a><font size="3">;<br>  char FAR  FAR </font><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><font color="#0000ff" size="3"><u>h_addr_list</u></font></a><font size="3">;<br>} hostent;</font></pre><pre class="syntax"><font size="3">我们需要使用其中的</font><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><font color="#0000ff" size="3"><u>h_addr_list</u></font></a><font size="3">，通过</font></pre><pre class="syntax"><font size="3">LPCSTR pszIP=inet_ntoa ((struct in_addr <em>)pHost-&gt;h_addr_list[0);即可得到IP地址，</em></font></pre><pre class="syntax"><font size="3">注意h_addr_list是主机地址列表，我们这里取的事第一个值，有的电脑装有多个网卡可能有多个IP地址。</font></pre><pre class="syntax"><font size="3">方法二是通过API函数getaddrinfo，通过上面的注释也可以看出ＭＳ推荐我们使用这个函数代替</font></pre><pre class="syntax"><font size="3">gethostbyname，因为这个函数既适用于IPv4也适用于IPv6，详见MSDN。</font></pre><pre><font size="3">The <strong>getaddrinfo</strong> function provides protocol-independent translation from host name to address.</font></pre><pre class="syntax"><font size="3"><strong>int</strong> <strong>getaddrinfo(</strong><br>  <strong>const TCHAR</strong> <em><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><u><font color="#0000ff">nodename</font></u></a></em></font><font size="3"><strong>,
</strong>  <strong>const TCHAR*</strong> <em><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><u><font color="#0000ff">servname</font></u></a></em></font><font size="3"><strong>,
</strong>  <strong>const struct addrinfo*</strong> <em><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><u><font color="#0000ff">hints</font></u></a></em></font><font size="3"><strong>,
</strong>  <strong>struct addrinfo**</strong> <em><a href="http://hi.baidu.com/fc/editor/" target="_blank" rel="noopener"><u><font color="#0000ff">res</font></u></a></em></font><strong><br>**</strong><font size="3">);</font><strong></strong></pre><pre class="syntax"><div class="reftip" style="VISIBILITY: hidden; OVERFLOW: visible; POSITION: absolute"><font size="3"> </font></div></pre><br><br>#### Parameters<br><pre class="syntax"><dl><dt><font size="3"><em>nodename</em> </font><dd><font size="3">[in] Pointer to a null-terminated string containing a host (node) name or a numeric host address string. The numeric host address string is a dotted-decimal IPv4 address or an IPv6 hex address. </font><dt><font size="3"><em>servname</em> </font><dd><font size="3">[in] Pointer to a null-terminated string containing either a service name or port number. </font><dt><font size="3"><em>hints</em> </font><dd><font size="3">[in] Pointer to an </font>[<font color="#0000ff" size="3"><u>addrinfo</u></font><strong>](ms-help://MS.MSDNQTR.v80.chs/MS.MSDN.v80/MS.WIN32COM.v10.en/winsock/winsock/addrinfo_2.htm)<font size="3"> structure that provides hints about the type of socket the caller supports. See Remarks. </font><dt><font size="3"><em>res</em> </font><dd><font size="3">[out] Pointer to a linked list of one or more </font></dd></dt></strong>addrinfo** structures containing response information about the host. </dd></dt></dd></dt></dd></dt></dl></pre><br><br><font size="3">MSDN说这个函数是用来提供一种与协议无关的主机名转换为地址的方法，参照MSDN上面的例子经过试验得出下面获取IP的方法：</font>

<font size="3">gethostname(hostname,100);&nbsp;&nbsp; //获得主机的名称<br>getaddrinfo(hostname,NULL,&amp;hints,&amp;res);&nbsp;&nbsp; //利用主机名称获取本地地址<br>char buff[100];<br>DWORD bufflen=100;<br>//将本地地址转换成字符串显示<br>struct sockaddr_in<em> pSockaddr=(sockaddr_in</em>)res-&gt;ai_addr;<br>char *pIP=inet_ntoa(pSockaddr-&gt;sin_addr);</font>

<font size="3">这里为什么说经过试验呢，MSDN上面的例子将getaddrinfo函数的前两个参数分别设置为主机IP和端口号，显然第一个参数不能设为主机IP了，根据其注释这个参数既可以为主机名也可以是IP，所以设为主机名，第二个参数说可以是一个服务名或者端口号，如果设为端口号，用WSAAddressToString函数获取的值中就包括该端口号，我也不太清楚这是什么原因，总之感觉这个Socket函数很诡异。</font>

<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/07/06/cstatusbar创建进度条问题/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/07/06/cstatusbar创建进度条问题/" itemprop="url">CStatusBar创建进度条问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-07-06T01:46:00+08:00">
                2008-07-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/VC/" itemprop="url" rel="index">
                    <span itemprop="name">VC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&lt;DIV class=cnt id=blog_text&gt;
</code></pre><font color="#800080" size="3">想在状态栏中创建一个进度条，没有在框架窗口中定义进度条，再以状态栏为父窗口创建，而是直接从CStatusBar派生一个类，在其中定义了一个CPropressCtrl成员，按照常规的创子控件思路在OnCreate中创建进度条，</font>

<font color="#800080" size="3">int CQTStatusBar::OnCreate(LPCREATESTRUCT lpCreateStruct)<br>{<br>if (CStatusBar::OnCreate(lpCreateStruct) == -1)<br>&nbsp;&nbsp; return -1;</font>

<font color="#800080" size="3">// TODO: 在此添加您专用的创建代码<br>CRect rect;<br>GetClientRect(&amp;rect);<br>rect.left=rect.right-150;<br>if(!m_wndProress)<br>m_wndProress.Create(WS_CHILD | WS_VISIBLE,rect,this,111);<br>m_wndProress.MoveWindow(rect,false);&nbsp;&nbsp; //为了在大小改变时重载位置<br>m_wndProress.SetRange(0,100);<br>m_wndProress.SetPos(50);</font>

<font color="#800080" size="3">return 0;<br>}</font>

<p><font color="#800080" size="3">结果发现进度条并没有产生，通过调试发现这里的rect根本就没有取到值，换在WM_PAINT消息里面处理，结果正常。纳闷了，难道是OnCreate中状态栏还未创建好吗？应该不是的，估计是MFC设计的问题，CStatusBar的Create函数里面就没让设置大小的函数。</font><br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/06/12/删除ctoolbar浮动时的菜单/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/06/12/删除ctoolbar浮动时的菜单/" itemprop="url">删除CToolBar浮动时的菜单</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-06-12T04:06:00+08:00">
                2008-06-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/VC/" itemprop="url" rel="index">
                    <span itemprop="name">VC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&amp;nbsp; 你可以通过重写ON_WM_WINDOWPOSCHANGED消息处理函数来删除浮动状态下的工具栏实际是系统菜单。这个函数在CToolBar的大小，位置或者Z轴顺序改变时被调用。我们并没有处理WM_SIZE消息处理函数，因为这个函数仅仅只是在大小改变时被调用，而每次当工具栏浮动时并没有被调用。 
</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我们可以通过CControlBar类的成员m_pDockBar成员而不是通过直接调用GetParent()来得到工具栏的父窗口。从CToolBar派生一个类，我暂且称之为CToolBarEx，当然你可以选择一个你认为适合的名字。我们仅仅是在工具栏浮动是删除实际是系统菜单,所以检查工具栏是否是正在浮动状态，并确保m_pDockBar是一个合法的指针。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在你的新类中添加如下成员变量： BOOL m_bMenuRemoved;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 当我们删除系统菜单时将其设置为TRUE，确保仅仅在需要是删除系统菜单。<br>我们需要得到一个m_pDockBar指针来检查工具栏是否确实是在一个CDockFrameWnd类中，以便可以安全地删除CToolBar的系统菜单。下面是示例代码:</p>
<p>#include &lt;afxpriv.h&gt;</p>
<p>void CXToolBar::OnWindowPosChanged(WINDOWPOS FAR* lpwndpos)</p>
<p>{</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; CToolBar::OnWindowPosChanged(lpwndpos);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; // should only be called once, when floated.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; if( IsFloating() )</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( m_pDockBar &amp;&amp; !m_bMenuRemoved )</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CWnd* pParent = m_pDockBar-&amp;gt;GetParent();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( pParent-&gt;IsKindOf(</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RUNTIME_CLASS(CMiniFrameWnd)))</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pParent-&gt;ModifyStyle( WS_SYSMENU, 0, 0 );</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_bMenuRemoved = TRUE;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; else if( m_bMenuRemoved ) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; m_bMenuRemoved = FALSE;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>}<br>原文网址:<a href="http://www.codejock.com/support/articles/mfc/general/g_8.asp" target="_blank" rel="noopener"><u><font color="#0000ff">www.codejock.com/support/articles/mfc/general/g_8.asp</font></u></a></p>
<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/05/23/求素数/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/05/23/求素数/" itemprop="url">求素数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-05-23T23:07:00+08:00">
                2008-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/数据结构-算法/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构/算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>&amp;nbsp;鉴于以前写程序那种不经过仔细思考及分析的不良习惯，觉得画流程翻还是很必要的，而且养成习惯后，对自己的思维锻炼以及高效正确编程有很大的好处。翻开大一时发的《C程序设计》第二章复习了一下，把上面一个很好的例子自己整理了一下，而且发现一个不错的画流程图的工具(Diagram Designer)。以下为全文：
</code></pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<span>问题：将</span><span><font face="Times New Roman">1</font></span><span>到</span><span><font face="Times New Roman">1000</font></span><span>之间的素数打印出来。</span>

<span>算法描述：“筛选”法，所谓“筛选法”指的是“</span><span><font face="Times New Roman">Eratosthenes</font></span><span>筛法”。他采取的方法是，在一张纸上写上</span><span><font face="Times New Roman">1</font></span><span>到</span><span><font face="Times New Roman">1000</font></span><span>全部整数，然后逐个判断它们是否是素数，找出一个非素数，就把它挖掉，最后剩下的就是素数。</span>

<span style="mso-ascii-: yes">①</span><span><font face="Times New Roman"> 2 3 </font></span><span style="mso-ascii-: yes">④</span><span><font face="Times New Roman"> 5 </font></span><span style="mso-ascii-: yes">⑥</span><span><font face="Times New Roman"> 7 </font></span><span style="mso-ascii-: yes">⑧</span><span><font face="Times New Roman"> </font></span><span style="mso-ascii-: yes">⑨</span><span><font face="Times New Roman"> </font></span><span style="mso-ascii-: yes">⑩</span><span>……</span><font face="Times New Roman"> </font><br><br><span>具体做法如下：</span>

<span style="mso-ascii-: yes">⑴</span><span>先将</span><span><font face="Times New Roman">1</font></span><span>挖掉（因为</span><span><font face="Times New Roman">1</font></span><span>不是素数）。</span>

<span style="mso-ascii-: yes">⑵</span><span>用</span><span><font face="Times New Roman">2</font></span><span>去除它后面的各个数，把能被</span><span><font face="Times New Roman">2</font></span><span>整除的数挖掉，即把</span><span><font face="Times New Roman">2</font></span><span>的倍数挖掉。</span>

<span style="mso-ascii-: yes">⑶</span><span>用</span><span><font face="Times New Roman">3</font></span><span>去除它后面的各数，把</span><span><font face="Times New Roman">3</font></span><span>的倍数挖掉</span>

<span style="mso-ascii-: yes">⑷</span><span>分别用</span><span><font face="Times New Roman">4</font></span><span>，</span><span><font face="Times New Roman">5</font></span><span>…各数作为除数去除这些数以后的各数。这个过程一直进行到在除数后面的数已经全被挖掉为止。事实上，只需进行到</span>

<span>上面的算法可以表示为：</span>

<span style="mso-ascii-: yes">⑴</span><span>挖去</span><span><font face="Times New Roman">1</font></span>

<span style="mso-ascii-: yes">⑵</span><span>用下一个未被挖去的数</span><span><font face="Times New Roman">p</font></span><span>去除</span><span><font face="Times New Roman">p</font></span><span>后面的各数，把</span><span><font face="Times New Roman">p</font></span><span>的倍数挖掉。</span>

<span style="mso-ascii-: yes">⑶</span><span>检查</span><span><font face="Times New Roman">p</font></span><span>是否小于的整数部分（如果</span><span><font face="Times New Roman">n=1000</font></span><span>，则检查</span><span><font face="Times New Roman">p&lt;31</font></span><span>？），如果是，则返回</span><span style="mso-ascii-: yes">⑵</span><span>继续执行，否则就结束。</span>

<span style="mso-ascii-: yes">⑷</span><span>纸上剩下的就是素数。</span>

<span>解题的基本思路有了，但要变成计算机的操作，还要做进一步的分析，如怎样判断一个数是否已被挖掉，怎样找出一个数</span><span><font face="Times New Roman">p</font></span><span>的倍数，怎样打印出来未被挖掉的数。</span>

<span>用自顶向下逐步细化的方法来处理这个问题，先进行“顶层设计”，见下图。也可以用流程图进行逐步细化。流程图</span><span><font face="Times New Roman">1</font></span><span>表示流程的粗略情况，把要做的三部分工作分别用</span><span><font face="Times New Roman">A</font></span><span>、</span><span><font face="Times New Roman">B</font></span><span>、</span><span><font face="Times New Roman">C</font></span><span>表示。 </span><br><span><br><div forimg="1"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/50a29d363623c4cea2cc2b28.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/50a29d363623c4cea2cc2b28.jpg" alt=""></a></div></span>

<span>这三部分还不够具体，要进一步细化。</span><span><font face="Times New Roman">A</font></span><span>部分可以细化为图</span><span><font face="Times New Roman">A</font></span><span>。先输入</span><span><font face="Times New Roman">n</font></span><span>，然后将</span><span><font face="Times New Roman">1</font></span><span>输入给</span><span><font face="Times New Roman">X1</font></span><span>，</span><span><font face="Times New Roman">2</font></span><span>输入</span><span><font face="Times New Roman">X2</font></span><span>，</span><span><font face="Times New Roman">1000</font></span><span>输入给</span><font face="Times New Roman"><span>X</span><span style="FONT-SIZE: 7.5pt">1000</span></font><span style="mso-ascii-: 10.5pt">。</span>

<span style="mso-bidi-font-size: 10.5pt"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/5bb5041bf679f1c6ac6e7529.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/5bb5041bf679f1c6ac6e7529.jpg" alt=""></a></span>

<span style="mso-ascii-: 10.5pt">B部分可以细化为图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">B</font></span><span style="mso-ascii-: 10.5pt">。</span>

<span style="mso-bidi-font-size: 10.5pt"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/735064fb189887314e4aea2a.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/735064fb189887314e4aea2a.jpg" alt=""></a></span>

<span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">B</font></span><span style="mso-ascii-: 10.5pt">中的</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">B1</font></span><span style="mso-ascii-: 10.5pt">和</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">B2</font></span><span style="mso-ascii-: 10.5pt">不能再分了。</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">B1</font></span><span style="mso-ascii-: 10.5pt">处理的方法是：使</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">X1=0</font></span><span style="mso-ascii-: 10.5pt">，即哪个数不是素数，就使它等于</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">0</font></span><span style="mso-ascii-: 10.5pt">，以后把不等于</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">0</font></span><span style="mso-ascii-: 10.5pt">的数打印处理就是所求的素鼠表。</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">B3</font></span><span style="mso-ascii-: 10.5pt">中的循环体内以</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">D</font></span><span style="mso-ascii-: 10.5pt">标志的部分还要进一步细化，对</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">D</font></span><span style="mso-ascii-: 10.5pt">细化为图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">D</font></span><span style="mso-ascii-: 10.5pt">。</span>

<span style="mso-bidi-font-size: 10.5pt"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/74cd06160bb4410b962b432b.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/74cd06160bb4410b962b432b.jpg" alt=""></a></span>

<div forimg="1"></div>

<p>图<span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">D</font></span><span style="mso-ascii-: 10.5pt">中的</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">E</font></span><span style="mso-ascii-: 10.5pt">部分还不够具体，再进一步细化为图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">E</font></span><span style="mso-ascii-: 10.5pt">。</span></p>
<span style="mso-ascii-: 10.5pt"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/e957c817ac1353124b90a735.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/e957c817ac1353124b90a735.jpg" alt=""></a></span>

<span style="mso-ascii-: 10.5pt">图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">E</font></span><span style="mso-ascii-: 10.5pt">中的</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">F</font></span><span style="mso-ascii-: 10.5pt">部分又细化为图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">F</font></span><span style="mso-ascii-: 10.5pt">，因为首先要判断某一个</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">Xj</font></span><span style="mso-ascii-: 10.5pt">是否已经被挖掉，如已被挖掉则不必考虑被</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">Xi</font></span><span style="mso-ascii-: 10.5pt">除。至此，已不能也不需要再分解了。</span>

<span style="mso-bidi-font-size: 10.5pt"><span style="mso-ascii-: 10.5pt"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/db517951464f5e9c8d543035.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/db517951464f5e9c8d543035.jpg" alt=""></a></span></span>

<span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">图1</font></span><span style="mso-ascii-: 10.5pt">中的</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">C</font></span><span style="mso-ascii-: 10.5pt">部分进行细化，得图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">C1</font></span><span style="mso-ascii-: 10.5pt">。</span>

<span style="mso-bidi-font-size: 10.5pt"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/2742ef0180aa521d7aec2c31.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/2742ef0180aa521d7aec2c31.jpg" alt=""></a></span>

<div forimg="1"></div>

<p>再对图<span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">C1</font></span><span style="mso-ascii-: 10.5pt">中的</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">G</font></span><span style="mso-ascii-: 10.5pt">部分进行细化，得图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">G</font></span><span style="mso-ascii-: 10.5pt">。</span></p>
<span style="mso-bidi-font-size: 10.5pt"><a href="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/2cd0d4083c67e0c263d98637.jpg" target="_blank" rel="noopener"><img src="http://hiphotos.baidu.com/qiutao%5F2008/abpic/item/2cd0d4083c67e0c263d98637.jpg" alt=""></a></span>

<span style="mso-ascii-: 10.5pt">至此，已将图</span><span style="mso-bidi-font-size: 10.5pt"><font face="Times New Roman">1</font></span><span style="mso-ascii-: 10.5pt">分解为能用三种基本结构表示的基本操作了。将以上这些图组合起来就可以得到最终的总流程图了，根据这个细化了的流程图已经可以用任何高级语言编写程序了。</span>

<p>有时间再把整个流程图组合在一起，然后把对应的程序也写一下，慢慢来吧，要走的路还长呢！&nbsp;&nbsp;&nbsp;</p>
<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2008/05/14/mfc透明控件的超级简单实现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2008/05/14/mfc透明控件的超级简单实现/" itemprop="url">MFC透明控件的超级简单实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2008-05-14T00:44:00+08:00">
                2008-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/VC/" itemprop="url" rel="index">
                    <span itemprop="name">VC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天在翻出以前写的一个程序时，想改下对话框的背景，结果导致Static控件的背景留下灰色的默认背景色，感觉很不爽，想着也学了这么久MFC了，这个问题今天一定要解决了，大致思路还是知道的，但是由于一直都是在学习，看别人的代码所以真真要自己写还是得仔细琢磨下，经过几番测试发现下面的方法最容易，贴上代码和截图吧：</p>
<p>// CQTTransparentStatic</p>
<p>class CQTTransparentStatic : public CStatic<br>{<br>DECLARE_DYNAMIC(CQTTransparentStatic)<br>public:<br>CQTTransparentStatic();<br>virtual ~CQTTransparentStatic();<br>//响应父类的反射消息<br>afx_msg HBRUSH CtlColor(CDC<em> /</em>pDC<em>/, UINT /</em>nCtlColor*/);<br>protected:<br>DECLARE_MESSAGE_MAP()<br>};</p>
<p>IMPLEMENT_DYNAMIC(CQTTransparentStatic, CStatic)</p>
<p>CQTTransparentStatic::CQTTransparentStatic()<br>{</p>
<p>}</p>
<p>CQTTransparentStatic::~CQTTransparentStatic()<br>{<br>}</p>
<p>BEGIN_MESSAGE_MAP(CQTTransparentStatic, CStatic)<br>ON_WM_CTLCOLOR_REFLECT()<br>END_MESSAGE_MAP()</p>
<p>// CQTTransparentStatic 消息处理程序</p>
<p>HBRUSH CQTTransparentStatic::CtlColor(CDC* pDC, UINT nCtlColor)<br>{<br>// TODO: 在此更改 DC 的任何属性<br>// TODO: 如果不应调用父级的处理程序，则返回非空画笔<br>pDC-&gt;SetBkMode(TRANSPARENT);<br>return (HBRUSH)::GetStockObject(HOLLOW_BRUSH);<br>}</p>
<p>代码真的是很简单吧，哈哈，</p>
<div forimg="1"><img src="http://hiphotos.baidu.com/qiutao%5F2008/pic/item/2742ef012d51c71d7aec2c49.jpg" alt=""></div>

<span style="FONT-SIZE: 10.5pt; mso-bidi-font-size: 12.0pt; mso-fareast-: 1.0pt">怎么样效果也还不错呢。</span>

<p></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">billowqiu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">153</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/billowqiu" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:billowqiu@163.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">billowqiu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
