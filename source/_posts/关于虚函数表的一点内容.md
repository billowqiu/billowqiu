---
title: 关于虚函数表的一点内容
id: 202
categories:
  - C++
date: 2007-07-26 18:21:00
tags:
---

    <TABLE style="TABLE-LAYOUT: fixed">
<TBODY>
<TR>
<TD>
<DIV class=cnt id=blog_text>还是用图表和代码能说明内容： 

#include &lt;iostream&gt;
using std::cout;
using std::endl;

class Base
{
public: //为了便于取地址 
&nbsp;&nbsp;&nbsp; int m_data1;
&nbsp;&nbsp;&nbsp; int m_data2;
&nbsp;&nbsp;&nbsp; int m_data3;
public:
&nbsp;&nbsp;&nbsp; void mem_fun1(); 
&nbsp;&nbsp;&nbsp; void mem_fun2();
&nbsp;&nbsp;&nbsp; //注意虽然后面没用到这些虚函数 ，但是要使程序可以编译通过
&nbsp;&nbsp;&nbsp; //需要实现他们，因为建立vtable会出错 
&nbsp;&nbsp;&nbsp; virtual void vir_fun1(){}
&nbsp;&nbsp;&nbsp; virtual void vir_fun2(){} 
};&nbsp;&nbsp;&nbsp;

class Derive:public Base
{
public://为了便于取地址 
&nbsp;&nbsp;&nbsp; int m_data1;
&nbsp;&nbsp;&nbsp; int m_data3;
&nbsp;&nbsp;&nbsp; int m_data4;
public:
&nbsp;&nbsp; void mem_fun1(); 
&nbsp;&nbsp;&nbsp; virtual void vir_fun2(){}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
};

int main()
{
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"sizeof(Base)=&gt; "&lt;&lt;sizeof(Base)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"sizeof(Derive)=&gt; "&lt;&lt;sizeof(Derive)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp; Base b;
&nbsp;&nbsp;&nbsp; Derive d;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of b=&gt; "&lt;&lt;&amp;b&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of b.m_data1=&gt; "&lt;&lt;&amp;(b.m_data1)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of b.m_data2=&gt; "&lt;&lt;&amp;(b.m_data2)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of b.m_data3=&gt; "&lt;&lt;&amp;(b.m_data3)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of d=&gt; "&lt;&lt;&amp;d&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of d.m_data1=&gt; "&lt;&lt;&amp;(d.m_data1)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of d.Base::m_data2=&gt; "&lt;&lt;&amp;(d.Base::m_data2)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of d.Base::m_data3=&gt; "&lt;&lt;&amp;(d.Base::m_data3)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of d.m_data3=&gt;"&lt;&lt;&amp;(d.m_data3)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Address of d.m_data4=&gt;"&lt;&lt;&amp;(d.m_data4)&lt;&lt;endl;
&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp; system("pause");
&nbsp;&nbsp;&nbsp; return 0;
}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

运行结果如图：

![](http://blog.programfan.com/upfile/200707/2007072600344.gif)

基类的大小为16是因为，三个int变量加上一个vptr，对应的Derive的大小就是在此基础上加三个int的大小，各数据成员的地址很清晰，也可以反映对象在内存中的存放情况。

下面两幅图是对象的内存模拟表示，看图应该就很清楚了：

![](http://blog.programfan.com/upfile/200707/20070726003415.gif)

![](http://blog.programfan.com/upfile/200707/2007072600349.gif)
</DIV></TD></TR></TBODY></TABLE>
</div>