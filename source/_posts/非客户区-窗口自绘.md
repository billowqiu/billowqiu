---
title: 非客户区 窗口自绘
id: 111
categories:
  - VC
date: 2011-03-26 23:51:00
tags:
---

    

<span style="font-family: mceinline;">在进行界面自绘时，一般都需要处理系统的边框，也就是所谓的非客户区，以前做界面时经常为这个问题发愁，那会摸索出了一种简单的方法：</span>

<span style="font-family: mceinline;">让窗口根本就不存在非客户区，所有的绘制都在客户区里面，但是只会引入另外一个问题，如何实现窗口需要通过鼠标拉伸变化大小？CodeProject上面有个例子可供参考</span><span style="font-family: mceinline;">[http://www.codeproject.com/KB/MFC/CustomWindow.aspx](http://www.codeproject.com/KB/MFC/CustomWindow.aspx)，里面的处理稍显麻烦，可以自己适当优化下。</span>

<span style="font-family: mceinline;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif;">
</span></span>

<span style="font-family: mceinline;">另外一种方法是在研究QQ2009之后的界面时发现的，通过SPY可以看出其可拉伸的窗口属性为：</span>

<span style="font-family: mceinline;">WS_EX_LEFT|WS_EX_LTRREADING|WS_EX_RIGHTSCROLLBAR|WS_EX_OVERLAPPEDWINDOW</span>

<span style="font-family: mceinline;">和</span>

<span><span style="font-family: mceinline;">WS_POPUP|WS_VISIBLE|WS_CLIPCHILDREN|WS_CLIPSIBLINGS|WS_SYSMENU|WS_THICKFRAME|WS_MAXIMIZEBOX|WS_MINIMIZEBOX</span></span>

<span><span style="font-family: mceinline;">这里主要是有一个|WS_THICKFRAME，一般情况下有这个属性的窗口肯定会带有系统边框，即带有非客户区，通过SPY++也可以看出其客户矩形的左边不是从0开始的，且是可以通过鼠标拉伸大小的，但是QQ的窗口通过SPY查看会发现其客户区和窗口一样大小，这是为什么呢，显然其通过某种手段将非客户区干掉了，这时我们肯定会想到WM_NCCALCSIZE消息，没错就是这个消息，我们直接在接收到这个消息的地方返回0即可，在MSDN2008里面对这个消息没有说明可以直接返回0，但是在在线版MSDN文档里面有下面这段：</span></span>

&nbsp;

Starting with Windows Vista, removing the standard frame by simply returning 0 when the _wParam_ is TRUE does not affect frames that are extended into the client area using the [**DwmExtendFrameIntoClientArea**](http://msdn.microsoft.com/en-us/library/aa969512(v=vs.85).aspx) function. Only the standard frame will be removed.

&nbsp;

&nbsp;

<span><span style="font-family: mceinline;">剩下的只需在WM_NCHITTEST消息里面处理即可了。</span></span>

<span style="font-family: mceinline;">具体实现可以参见下面这个例子：[http://download.csdn.net/source/3130708](http://download.csdn.net/source/3130708)</span>

&nbsp;

<span style="font-family: mceinline;">PS：写此文主要是最近看到网上很多开源的DirectUI库，想起当初刚工作那会的界面开发工作，确实学到了不少东西，在研究某个库时发现了WM_NCCALCSIZE直接返回0即可去掉系统非客户区，有趣的是在线版MSDN对这个有说明，而我的本地版没有，让我走了不少弯路啊</span>

</div>