---
title: 服务端通讯框架(库)
id: 733
categories:
  - Linux
  - 网络通讯
tags:
---

提到服务器通信(本文仅指网络相关)，不得不提常见的网络I/O模型，在网上随便搜一下非阻塞，异步IO，大把这方面的深入讲解，UNP和陈硕的两幅图也是比较全面的总结了这些模型。

[![unp_io_model](/images/2015/07/unp_io_model.png)](/images/2015/07/unp_io_model.png) [![chenshuo_io_model](/images/2015/07/chenshuo_io_model.png)](/images/2015/07/chenshuo_io_model.png)

因此我也不打算写这块的东西，而是侧重于我在工作中实际用到的几个框架：

*   asio
*   thrift，xxx-rpc
*   tbus
*   spp
在设计网络框架的时候经常提到reactor、proactor，主要区别是前者的IO还是同步的(通常会设置为非阻塞)，而后者是比较典型的aio。asio提供的是proactor模型，在linux下其是通过epoll+非阻塞IO模拟的异步IO，从而提供了proactor的编程接口，简单来说就是注册socket，发起异步io并设置回掉函数，当回调函数被调用时，对应的数据已经准备好了。

[![asio_op1](/images/2015/07/asio_op1.png)](/images/2015/07/asio_op1.png)

[![asio_op2](/images/2015/07/asio_op2.png)](/images/2015/07/asio_op2.png)

使用asio的话，有一些需要注意的地方，比如缓冲区的管理，因为一次IO操作可能不会全部发送/接受完毕数据，这时如果又要进行IO的话需要自己管理好这块的数据，在其手册上有如下描述：

This operation(async_write) is implemented in terms of zero or more calls to the stream's async_write_some function, and is known as a <span class="emphasis">_composed operation_</span>. The program must ensure that the stream performs no other write operations (such as async_write, the stream's async_write_some function, or any other composed operations that perform writes) until this operation completes.

thrift，xxx-rpc

这个属于比较上层的通信的框架了，开发模式也很像，就是定义一个thrift或者proto文件，剩下的就是实现接口，提供服务，这样方式开发服务相对来说最简单。

tbus

这个是腾讯IEG研发部开发的一套通讯框架，将服务器通信部分完全抽象化，支持单机多进程和多机通讯，多机通讯时所有的网络IO都有tbusd完成，业务开发者只需调用相应的api进行数据的收发(基本上就是共享内存的操作)，架构如下：

&nbsp;