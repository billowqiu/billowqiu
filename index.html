<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="taocoding">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="taocoding">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="taocoding">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>taocoding</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d13234060d812cb98a47e937139083a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">taocoding</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/29/envoy-00/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/29/envoy-00/" itemprop="url">Envoy初试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-29T21:55:38+08:00">
                2019-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/microservice/" itemprop="url" rel="index">
                    <span itemprop="name">microservice</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/microservice/service-mesh/" itemprop="url" rel="index">
                    <span itemprop="name">service-mesh</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这两天抽空试玩了一下envoy：</p>
<h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><p>习惯于编译代码然后debug，而最新的代码依赖实在过于庞大，因此选择了envoy的第一个<a href="https://github.com/envoyproxy/envoy/releases/tag/v1.0.0" target="_blank" rel="noopener">开源版本</a><br>稍微修改了一下自带的ci脚本，将对应的第三方依赖手动下载之后，目前基本上可以做到二键编译（在我的Ubuntu 16.04.3 LTS虚拟机上编译通过）。</p>
<h4 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h4><p>envoy初期版本的配置是json格式的，现在的版本已经改成了yaml了，尽管是1.0.0版本，envoy配置还是显得非常丰富，主要包括以下几大类：</p>
<ul>
<li>listeners：监听器，也就是对外供downstream链接的配置</li>
<li>admin：管理端口</li>
<li>cluster_manager：upstream的集群配置，提供诸如服务发现，负载均衡，健康检查等特性</li>
<li>flags_path：基于文件的配置指令</li>
<li>statsd_local_udp_port：上报统计数据的statsd服务对应的udp端口</li>
<li>statsd_tcp_cluster_name：上报统计数据的statsd服务对应的tcp服务集群名</li>
<li>tracing：调用链数据上报配置</li>
<li>rate_limit_service：外部依赖的全局限流服务</li>
<li>runtime：运行时动态配置，可以做到热加载</li>
</ul>
<p>其中前三类为必选的，其中每类里面又分为各个小类别，看下文这个例子就很清楚了。</p>
<h4 id="一个基于mongodb的代理例子"><a href="#一个基于mongodb的代理例子" class="headerlink" title="一个基于mongodb的代理例子"></a>一个基于mongodb的代理例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;listeners&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;port&quot;: 10086,</span><br><span class="line">      &quot;filters&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;type&quot;: &quot;both&quot;,</span><br><span class="line">          &quot;name&quot;: &quot;mongo_proxy&quot;,</span><br><span class="line">          &quot;config&quot;: &#123;</span><br><span class="line">            &quot;stat_prefix&quot;: &quot;mongo_stat&quot;,</span><br><span class="line">            &quot;access_log&quot;: &quot;mongo_access&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;type&quot;: &quot;read&quot;,</span><br><span class="line">          &quot;name&quot;: &quot;tcp_proxy&quot;,</span><br><span class="line">          &quot;config&quot;: &#123;</span><br><span class="line">            &quot;cluster&quot;: &quot;mongo-db&quot;,</span><br><span class="line">            &quot;stat_prefix&quot;: &quot;tcp_proxy&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;admin&quot;: &#123;</span><br><span class="line">    &quot;access_log_path&quot;: &quot;/dev/null&quot;,</span><br><span class="line">    &quot;port&quot;: 8001</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;cluster_manager&quot;: &#123;</span><br><span class="line">    &quot;clusters&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;mongo-db&quot;,</span><br><span class="line">        &quot;connect_timeout_ms&quot;: 250,</span><br><span class="line">        &quot;type&quot;: &quot;static&quot;,</span><br><span class="line">        &quot;lb_type&quot;: &quot;round_robin&quot;,</span><br><span class="line">        &quot;hosts&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;url&quot;: &quot;tcp://10.0.0.6:27017&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/2019/10/envoy_00.png" alt="" title="mongo_proxy"></p>
<p>这里需要注意的是listeners里面可以有多个filters，组成一个类似职责链的模式。<br>官网文档有一段描述：</p>
<blockquote>
<p>Since Envoy is fundamentally written as a L3/L4 server, basic L3/L4 proxy is easily implemented. The TCP proxy filter performs basic 1:1 network connection proxy between downstream clients and upstream clusters. It can be used by itself as an stunnel replacement, or in conjunction with other filters such as the MongoDB filter or the rate limit filter.</p>
</blockquote>
<p>envoy对于L3/4层有一个基础的实现，像示例中的mongo_proxy其实只是做了各类统计工作，一般都需要额外配置一个tcp_proxy来做流量转发。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/10/microservice-00/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/10/microservice-00/" itemprop="url">那些年见识过的微服务思想</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-10T22:10:20+08:00">
                2019-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/microservice/" itemprop="url" rel="index">
                    <span itemprop="name">microservice</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Martin大叔那篇著名的<a href="https://martinfowler.com/articles/microservices.html" target="_blank" rel="noopener">微服务</a>文章出来后，”微服务”这个词逐渐进入大众视野，然后一系列关于微服务的框架，治理手段层出不穷，如spring cloud全家桶。</p>
<p>经过这一年多对服务框架和调用链的实践，多多少少有些体会，每次在套用这些名词的时候总会有一种似曾相识的感觉，静下心来想想其实在鹅厂的时候已经接触不过不少相关的套路，那会大叔的文章并没有出来，也没有人把他给总结的这么高大上，这里先堆一些名词，等日后慢慢丰富。</p>
<h3 id="大系统小做"><a href="#大系统小做" class="headerlink" title="大系统小做"></a>大系统小做</h3><blockquote>
<p>将功能复杂较大的系统，化大为小，减少模块耦合，降低相关联性，用多个独立的进程相互协作来实现整体的复杂系统功能，比如把读和写的功能分成不同的进程实现。</p>
</blockquote>
<ul>
<li>微服务思想的精髓</li>
</ul>
<h3 id="tbus，spp"><a href="#tbus，spp" class="headerlink" title="tbus，spp"></a>tbus，spp</h3><blockquote>
<p>前者是IEG当时游戏服务器的标配框架，后者是SNG业务服务的标配框架。<br>两者都共同点是业务进程通过网络或者共享内存与本机的一个代理进程进行通信，该代理进程负责与外部其他节点&gt; 通信，从而对业务屏蔽了网络通信的逻辑，想想这不就是现在service-mesh中的sidecar么。</p>
</blockquote>
<ul>
<li>service mesh</li>
</ul>
<h3 id="QZA"><a href="#QZA" class="headerlink" title="QZA"></a>QZA</h3><blockquote>
<p>由于qzone平台层的模块众多，中间层的业务对接起来不可能都自己去实现一套协议转换，鉴权，频率控制等逻辑，于是qza(qzone access)应运而生</p>
</blockquote>
<ul>
<li>API网关</li>
</ul>
<h3 id="CLog"><a href="#CLog" class="headerlink" title="CLog"></a>CLog</h3><blockquote>
<p>当时这个系统印象比较深刻的用途就是给老板(GM)这类人专门定位问题的，比较模块太多了，一个一个log查起来不现实，只能把log集中存储，按照uin，seq等维度来聚合。</p>
</blockquote>
<ul>
<li>染色，调用链</li>
</ul>
<h3 id="L5"><a href="#L5" class="headerlink" title="L5"></a>L5</h3><blockquote>
<p>这是个神器，当时SNG基本上所有的业务机器上面都有一个L5-Agent，干啥呢，就是帮你做服务发现，你每次调用下游服务的时候，都会通过api从其共享内存中拿一个IP:PORT，拿的过程就做了负载均衡了，只不过调用者感受不到，调用完下游服务之后，你会上报这次调用的结果(返回码，耗时等)，基于这些上报，当某个下游服务出故障了，他会自动帮你摘除掉该节点，这不就是熔断么。</p>
</blockquote>
<ul>
<li>服务发现</li>
<li>负载均衡</li>
<li>熔断</li>
</ul>
<h3 id="柔性可用"><a href="#柔性可用" class="headerlink" title="柔性可用"></a>柔性可用</h3><blockquote>
<p>“结合用户使用场景，根据资源消耗，调整产品策略，设计几个级别的、不同的用户体验，最大限度的保证关键服务的可用性。” 这跟降级的思路基本一致。</p>
</blockquote>
<ul>
<li>降级</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/30/importance-of-stability/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/30/importance-of-stability/" itemprop="url">稳定的重要性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-30T22:37:10+08:00">
                2019-06-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/思考/" itemprop="url" rel="index">
                    <span itemprop="name">思考</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文摘抄自微信公众号：插坐学院</p>
<p>虽说是鸡汤文，但是将其对照到工作和生活中确实有那么一些似曾相识，不管是技术上常常提到的系统稳定性，还是与人相处过程中的情绪和内心稳定性。</p>
<hr>
<h4 id="情绪稳定：是成年人最稀缺的能力"><a href="#情绪稳定：是成年人最稀缺的能力" class="headerlink" title="情绪稳定：是成年人最稀缺的能力"></a>情绪稳定：是成年人最稀缺的能力</h4><p>在《危险人格识别》一书中，情绪不稳定被视为危险人格。情绪不稳定的人往往缺乏控制情绪的能力，一点点刺激就能让情绪成为他的主人。这就导致他们性情多变，且极端跳跃。</p>
<p>人们都是追求安稳平静的，没有人喜欢在惊吓中度日。过度的愤怒与抱怨，只会让朋友、机会越来越远。周而复始形成恶性循环，工作生活都可能受到影响，伤害的是自己。</p>
<p>情绪不稳定的人，往往还会选择向亲人发火。当争吵成为家庭生活的常态，坏情绪传染太多，不论是亲情还是爱情都会在反复无常的“变脸”中消磨殆尽。</p>
<p>其实，不管遇到了多大的困难和痛楚，总有人能做到向死而生，生活永远不会崩溃，会崩溃的只有我们那经不起考验的情绪。</p>
<p>观察生活我们能发现，那些真正优秀的人，那些会让你打心眼里产生依赖感、信任感、安全感、亲近感的人，往往都是情绪很稳定的人。</p>
<p>他们遇到突发情况镇定自若，不会大惊失色、六神无主；<br>遇到困难，执着坚定，不会轻易怀疑后退；<br>遇到愤怒的事谋定后动、尽力周旋，不会一冲动就不计后果。</p>
<hr>
<h4 id="能力稳定：决定了一个人能走多远"><a href="#能力稳定：决定了一个人能走多远" class="headerlink" title="能力稳定：决定了一个人能走多远"></a>能力稳定：决定了一个人能走多远</h4><p>“通盘无妙手”是一个下棋的术语，是说很会下棋的人，往往一整盘棋你是看不到那种神奇的一招，或者力挽狂澜的一手的。</p>
<p>这有点违反我们的直觉，为什么是这样呢？</p>
<p>韩国有一位围棋选手叫李昌镐，是围棋界的世界级顶尖高手。他下棋最大的特点，也是最让对手头疼的手法，就是每手棋，只求51%的胜率，俗称“半目胜”。</p>
<p>他曾对记者说：“我从不追求妙手，也没想过要一举击溃对手。”只要每一步比对手好一点点，就足够赢了。</p>
<p>这恰恰是高手的战略。所谓的“妙手”，虽然看起来很酷，赢得很漂亮，但存在一个问题——给对方致命一击的同时，往往也会暴露自己的缺陷，正所谓“大胜之后，必有大败；大明之后，必有大暗”。</p>
<p>而且，“妙手”存在不稳定和不可持续性，无法通过刻意练习来形成技能上的积累，一旦“灵感”枯竭，难免手足无措。正如守卫一座城池，只靠“奇兵”是不行的，终归要有深沟、高垒的防护。</p>
<p>而与之相比，“通盘无妙手”看似平淡无奇，但是积胜势于点滴、化危机于无形，最终取得胜利是稳稳当当的。</p>
<p>真正的高手，都懂得能力稳定的重要性，他们稳定地“输入”，稳定地“输出”。</p>
<p>每天提高一点点，再前进一点点，到一定时候回头看，你会发现，自己已经走出了很远的距离。</p>
<hr>
<h4 id="内心稳定：是一个人幸福的根本本源"><a href="#内心稳定：是一个人幸福的根本本源" class="headerlink" title="内心稳定：是一个人幸福的根本本源"></a>内心稳定：是一个人幸福的根本本源</h4><p>每个人的内心，都有一种深层的不安存在着。心灵内部的那种无助感，那种随波逐流，那种对前程的不确定感……常常令我们力不从心。</p>
<p>所谓内心稳定，首先是内心对未来的笃定，不急躁，不盲目。只要方向正确，步子稳定，何时抵达只是时间问题罢了。</p>
<p>其次是对生活稳定的把握。明白什么是可以改变的，比如如何看待自己，看待世界，然后尽自己所能去改变它；明白什么是自己无力改变的，然后放手，看淡。</p>
<p>人生一世，草木一秋，即使是物欲横流，也要坚守，唯有静心笃定，方能不乱一心，安然面对。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/11/jaeger-practice/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/11/jaeger-practice/" itemprop="url">jaeger实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-11T20:12:56+08:00">
                2019-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/microservice/" itemprop="url" rel="index">
                    <span itemprop="name">microservice</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>做tracing选型时发现除了Zipkin(这个其实很久之前就有所闻，但是一直没实操过)，还有Uber开源的<a href="https://www.jaegertracing.io" target="_blank" rel="noopener">Jaeger</a>，看到官网就感觉这是一个用心的产品，这个应该离不开Uber有专门的团队维护。</p>
<h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><p>官网列了几个特性：</p>
<ul>
<li>Opentracing兼容，提供了Go, Java, Node, Python, C++的官方客户端</li>
<li>服务之间使用一致的采样逻辑</li>
<li>多存储支持：Cassandra, Elasticsearch, Kafka, memory</li>
<li>动态采样(吐槽一下这个，一年多了，还没合入开源版本)</li>
<li>支持收集的数据做后续分析</li>
<li>现代化的UI</li>
<li>云原生支持</li>
<li>可视化(每个组建都支持将metric导出到Prometheus)</li>
<li>兼容Zipkin</li>
</ul>
<p>由于调研的时候没法对细节做深入了解，当时选择Jaeger最重要的一点其实是其实是：<strong>jaeger-agent是一个通过UDP方式接收本机发出的spans。</strong><br>为什么是这一点呢？因为对于业务来说tracing其实是一个相对无关紧要的东西，如果给一个TCP的通道让它上报，其实是不太友好的，性能和维护性方面都没有UDP好。</p>
<h4 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h4><p><img src="https://www.jaegertracing.io/img/architecture-v1.png" alt="Jaeger架构图"></p>
<ul>
<li>jaeger-client：嵌入在应用程序里面，负责span的创建以及上报</li>
<li>jaeger-agent：每个物理机部署一个，负责收集client上报的span，然后转发给collector</li>
<li>jaeger-collector：接收agent发来的span，写入后端存储</li>
<li>jaeger-query：提供rest接口，负责从存储中拉取trace信息供UI查询</li>
<li>jaeger-ui：展示trace和服务依赖图</li>
</ul>
<h4 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h4><p>如果想快速体验，可以按照官网的<a href="https://www.jaegertracing.io/docs/1.11/deployment/" target="_blank" rel="noopener">Docker</a>方式部署，由于当时的线上环境还没有这方面的支持，下面以最新的Release二进制版本简述一下部署的流程。</p>
<h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><ul>
<li>Jaeger安装包:<br>  <a href="https://github.com/jaegertracing/jaeger/releases/download/v1.11.0/jaeger-1.11.0-darwin-amd64.tar.gz" target="_blank" rel="noopener">https://github.com/jaegertracing/jaeger/releases/download/v1.11.0/jaeger-1.11.0-darwin-amd64.tar.gz</a></li>
<li>elasticsearch-6.4.0:<br>  <a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.4.0.tar.gz" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.4.0.tar.gz</a></li>
</ul>
<h5 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h5><ol>
<li>bin/elasticsearch</li>
<li>SPAN_STORAGE_TYPE=elasticsearch ./jaeger-collector</li>
<li>./jaeger-agent –collector.host-port 127.0.0.1:14267</li>
<li>SPAN_STORAGE_TYPE=elasticsearch ./jaeger-query</li>
</ol>
<p>打开<a href="http://127.0.0.1:16686即可看到Jaeger的查询页面：" target="_blank" rel="noopener">http://127.0.0.1:16686即可看到Jaeger的查询页面：</a><br><img src="/images/2019/04/jaeger-ui.png" alt="" title="jaeger-ui"></p>
<ul>
<li>Search，按照 服务:操作，tag，时间等维度进行trace的筛选</li>
<li>Compare，比较两个trace</li>
<li>Dependencies，查看服务依赖图，这个需要一个单独的Spark任务才能生成，下文会讲到</li>
</ul>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><p>Jaeger的安装包里面自带了一个测试程序:example-hotrod，模拟Uber的打车服务，通过如下方式启动：</p>
<pre><code>jaeger-1.11.0-darwin-amd64 billowqiu$ ./example-hotrod all
</code></pre><p>这样会一次性启动所有的服务，包括：Customer service，Driver service，Route service，Frontend service，同时内部还会模拟调用MySQL和Redis。<br>启动该服务后，打开<a href="http://127.0.0.1:8080/" target="_blank" rel="noopener">http://127.0.0.1:8080/</a> 随便点一个乘客姓名，这时在Jaeger的ui里面可以看到如下trace：<br><img src="/images/2019/04/hotrod_trace.png" alt="" title="hotrod_trace"></p>
<p>点进去可以看到详细的trace：<br><img src="/images/2019/04/hotrod_trace_detail.png" alt="" title="hotrod_trace_detail"></p>
<h5 id="Dependencies生成"><a href="#Dependencies生成" class="headerlink" title="Dependencies生成"></a>Dependencies生成</h5><p>上面通过例子程序可以看到6个服务的调用流程及耗时等trace数据，但是<a href="http://127.0.0.1:16686/dependencies" target="_blank" rel="noopener">http://127.0.0.1:16686/dependencies</a> 里面依然是空的，这是因为服务依赖图需要单独的任务生成：<br>    <a href="https://github.com/jaegertracing/spark-dependencies" target="_blank" rel="noopener">jaegertracing/spark-dependencies</a>， 当时为了解决一个生产环境的问题，还为这个项目提了个<a href="https://github.com/jaegertracing/spark-dependencies/pull/39" target="_blank" rel="noopener">pr</a>，最后官方合入了master，也算是一个小惊喜吧。<br>代码clone下来之后执行：</p>
<pre><code>spark-dependencies billowqiu$ mvn clean package -Dmaven.test.skip=true
</code></pre><p>这样会build一个jar包，然后执行：</p>
<pre><code>spark-dependencies billowqiu$ STORAGE=elasticsearch ES_NODES=http://localhost:9200 java -jar jaeger-spark-dependencies/target/jaeger-spark-dependencies-0.0.1-SNAPSHOT.jar
</code></pre><p>在Mac下面可能会出现：Can’t assign requested address: Service ‘sparkDriver’ failed after 16 retries (starting from 0) 这个错误，可以参照<a href="https://stackoverflow.com/questions/34601554/mac-spark-shell-error-initializing-sparkcontext" target="_blank" rel="noopener">这个</a>解决。<br>这时再打开<a href="http://127.0.0.1:16686/dependencies" target="_blank" rel="noopener">http://127.0.0.1:16686/dependencies</a> 选择DAG，服务依赖如图所示：</p>
<p><img src="/images/2019/04/hotrod_trace_dependencies.png" alt="" title="hotrod_trace_dependencies"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/11/opentracing-api-overview/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/11/opentracing-api-overview/" itemprop="url">opentracing-api-overview</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-11T21:27:00+08:00">
                2018-11-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/microservice/" itemprop="url" rel="index">
                    <span itemprop="name">microservice</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>opentracing是一个API规范，各类框架和库负责实现该规范，从而允许开发人员通过手动埋点实现平台无关的tracing跟踪。目前主流的语言都有对应的接口提供，具体可以参考<a href="https://opentracing.io/docs/supported-languages" target="_blank" rel="noopener">链接</a>。下面以opentracing-go为例对其做一个大致介绍。</p>
<h3 id="Span"><a href="#Span" class="headerlink" title="Span"></a>Span</h3><h4 id="SpanContext"><a href="#SpanContext" class="headerlink" title="SpanContext"></a>SpanContext</h4><p>表示一个Span的状态，通常会传递给相关联的Span，也包括跨进程传递，例如&lt;trace_id, span_id, sampled&gt;。主要接口有：<br>ForeachBaggageItem(handler func(k, v string) bool)，handler函数会针对每个BaggageItem进行调用。</p>
<h4 id="Baggage"><a href="#Baggage" class="headerlink" title="Baggage"></a>Baggage</h4><p>跟spancontext一样也是跨进程传递的，为一系列key：value对</p>
<h4 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h4><p>设置用于过滤span的tags，其中key必须是string类型，value可以是任意类型，opentracing有一些预定义的<a href="https://github.com/opentracing/specification/blob/master/semantic_conventions.md" target="_blank" rel="noopener">tags</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SetTag(key string, value interface&#123;&#125;) Span</span><br><span class="line">span.SetTag()</span><br></pre></td></tr></table></figure></p>
<h4 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LogFields(fields ...log.Field)</span><br><span class="line">//    span.LogFields(</span><br><span class="line">//        log.String(&quot;event&quot;, &quot;soft error&quot;),</span><br><span class="line">//        log.String(&quot;type&quot;, &quot;cache timeout&quot;),</span><br><span class="line">//        log.Int(&quot;waited.millis&quot;, 1500))</span><br></pre></td></tr></table></figure>
<h4 id="Finish"><a href="#Finish" class="headerlink" title="Finish"></a>Finish</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FinishWithOptions(opts FinishOptions)</span><br><span class="line">通常这是对于span的最后一个操作，目前看到的实现基本上都是在这个动作做span的上报。</span><br><span class="line"></span><br><span class="line">type FinishOptions struct &#123;</span><br><span class="line">    FinishTime time.Time    // 重写span的结束时间</span><br><span class="line">    LogRecords []LogRecord  // 可以在这个时候一次性写入所有的Log,效果同手动调用LogFields</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个span的列子:</p>
<pre><code>t=0            operation name: db_query               t=x 

 +-----------------------------------------------------+
 | · · · · · · · · · ·    Span     · · · · · · · · · · |
 +-----------------------------------------------------+
</code></pre><p>Tags:</p>
<ul>
<li>db.instance:”jdbc:mysql://127.0.0.1:3306/customers</li>
<li>db.statement: “SELECT * FROM mytable WHERE foo=’bar’;”</li>
</ul>
<p>Logs:</p>
<ul>
<li>message:”Can’t connect to mysql server on ‘127.0.0.1’(10061)”</li>
</ul>
<p>SpanContext:</p>
<ul>
<li>trace_id:”abc123”</li>
<li>span_id:”xyz789”</li>
<li>Baggage Items:<ul>
<li>special_id:”vsid1738”</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Tracer"><a href="#Tracer" class="headerlink" title="Tracer"></a>Tracer</h3><p>负责创建Span和SpanContext的传播，属于一个Manager角色。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">type SpanReference struct &#123;</span><br><span class="line">    // 与ReferencedContext的关联关系，有ChildOfRef和FollowsFromRef，具体可见http://opentracing.io/spec/</span><br><span class="line">	Type              SpanReferenceType </span><br><span class="line">	// 需要建立关联关系的spancontext</span><br><span class="line">	ReferencedContext SpanContext</span><br><span class="line">&#125;</span><br><span class="line">type StartSpanOptions struct &#123;</span><br><span class="line">	// 一次可以设置0到多个span之间的关联，如果不设置此字段，表明当前创建的span为root span</span><br><span class="line">	References []SpanReference  </span><br><span class="line"></span><br><span class="line">	// StartTime overrides the Span&apos;s start time, or implicitly becomes</span><br><span class="line">	// time.Now() if StartTime.IsZero().</span><br><span class="line">	// 指定span的开始时间</span><br><span class="line">	StartTime time.Time</span><br><span class="line"></span><br><span class="line">    // 类似于Span的SetTag()</span><br><span class="line">	Tags map[string]interface&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建一个新的span</span><br><span class="line">StartSpan(operationName string, opts ...StartSpanOption) Span</span><br><span class="line"></span><br><span class="line">// 将sm按照format的格式序列化到carrier，通常是在client端调用</span><br><span class="line">Inject(sm SpanContext, format interface&#123;&#125;, carrier interface&#123;&#125;) error</span><br><span class="line">// 从carrier中按照format的格式取出sm，通常是在server端收到client调用后，取出spancontext</span><br><span class="line">Extract(format interface&#123;&#125;, carrier interface&#123;&#125;) (SpanContext, error)</span><br><span class="line"></span><br><span class="line">// opentracing有定义一些内置的BuiltinFormat：</span><br><span class="line">Binary：二进制方式</span><br><span class="line">TextMap：key:value 的string pairs，对应的carrier类型为map[string]string</span><br><span class="line">HTTPHeaders：作为HTTP header的string pairs，对应的carrier类型为http.Header</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/21/distrituted-tracing-history/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/21/distrituted-tracing-history/" itemprop="url">分布式跟踪系统历史</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-21T23:23:27+08:00">
                2018-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/microservice/" itemprop="url" rel="index">
                    <span itemprop="name">microservice</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>从五月份到现在一直都在和tracing打交道，也算对这个领域有了一定的了解，打算做点记录，第一篇就从tracing系统的历史说起。</p>
<h4 id="tracing系统历史"><a href="#tracing系统历史" class="headerlink" title="tracing系统历史"></a>tracing系统历史</h4><p>Google在互联网领域基础设施方面的理论贡献真的是当之无愧的No.1，从早期的三驾马车，到tracing相关开源系统的鼻祖<a href="https://ai.google/research/pubs/pub36356" target="_blank" rel="noopener">Dapper</a>，再到近年的spanner，F1等等，几乎都是发个paper科普一下自家已经运营N年的东西，然后开源领域就各种开种”山寨”。<br>调用链跟踪这个话题，其实很早就有了，具体可以去翻看一下dapper的引用文献，但是最近两年因为微服务的火热，各大公司才开始真正对这个东西重视，毕竟一个接口的调用可能引起几十个甚至上百个下游服务的调用，如果没有一个跟踪系统，对于问题的定位难度可想而知。</p>
<ul>
<li>Dapper论文发表于2010年，<a href="http://bigbully.github.io/Dapper-translation/" target="_blank" rel="noopener">翻译版</a></li>
<li>Twitter在2012年开源了<a href="https://blog.twitter.com/engineering/en_us/a/2012/distributed-systems-tracing-with-zipkin.html" target="_blank" rel="noopener">zipkin</a></li>
<li>zipkin开源后<ul>
<li>估计Twitter维护不力，而且是相对小众的scale写的，后面由开源社区用java重写了并改名为<a href="https://zipkin.io" target="_blank" rel="noopener">OpenZipkin</a>继续维护维护</li>
<li>7月份完成了2.0的数据模型切换<a href="https://github.com/openzipkin/zipkin/releases/tag/2.10.1" target="_blank" rel="noopener">Zipkin 2.10 completes our v2 migration</a></li>
<li>8.30号捐给了<a href="http://incubator.apache.org/projects/zipkin.html" target="_blank" rel="noopener">Apache</a>。</li>
</ul>
</li>
<li>Jaeger的诞生<ul>
<li>Uber在集成到内部系统之后各种坑出来了，具体可见<a href="https://eng.uber.com/distributed-tracing/" target="_blank" rel="noopener">Evolving Distributed Tracing at Uber Engineering</a>，于是另起炉灶于2017年初开源了<a href="https://www.jaegertracing.io" target="_blank" rel="noopener">Jaeger</a></li>
</ul>
</li>
</ul>
<h4 id="tracing标准"><a href="#tracing标准" class="headerlink" title="tracing标准"></a>tracing标准</h4><ul>
<li><p><a href="https://opentracing.io/" target="_blank" rel="noopener">opentracing</a></p>
<p>  2016年就开始启动了，为了解决tracing系统各自为政，搞了个统一的标准，并提供了各种语言的api。目前的主要参与者为Uber，LightStep(Dapper第一作者的公司)，Redhat(Jaeger开源后，直接放弃自家研发的类似产品，转而到Jaeger上面来了，哈)等公司。</p>
</li>
<li><p><a href="https://opencensus.io/" target="_blank" rel="noopener">opencensus</a></p>
<p>  Google年初提出的一个集metrics和tracing的新标准，估计一方面是看到Opentracing想竞争一把，就像之前的容器编排一样，另外也可以推广自己家的<a href="https://cloud.google.com/stackdriver/" target="_blank" rel="noopener">Stackdriver</a>，目前<a href="https://open.microsoft.com/2018/06/13/microsoft-joins-the-opencensus-project/" target="_blank" rel="noopener">微软</a>也加入了对该标准的支持，准备搞到自己的Auze里面。</p>
</li>
<li><p><a href="https://github.com/w3c/distributed-tracing" target="_blank" rel="noopener">w3c/distributed-tracing</a></p>
<p>  2017年提出的一个为了统一各种tracer系统中Context格式标准，目前还是Draft阶段，主要参与者为Google和微软。</p>
</li>
</ul>
<h4 id="tracer实现"><a href="#tracer实现" class="headerlink" title="tracer实现"></a>tracer实现</h4><p>上面提到了三个tracing标准，w3c的就不说了，opencensus由于是谷歌主导的，参与者不多，相应的tracer实现也只有自家的Stackdriver。<br>opentracing实现则是<a href="https://opentracing.io/docs/supported-tracers/" target="_blank" rel="noopener">遍地开花</a>：</p>
<ul>
<li>Jaeger</li>
<li>Appdash</li>
<li>LightStep</li>
<li>Instana</li>
<li>SkyWalking</li>
<li>inspectIT</li>
<li>stagemonitor</li>
<li>Datadog</li>
</ul>
<p>其中大部分都是商业产品，顺带支持一下opentracing，而且都是属于APM级别的，Zipkin竟然不在名列！！！<br>开源方面的，Jaeger和Appdash都是go语言开发的，部署起来相对比较轻便；而且Jaeger背后有Uber支持，提供了个各种语言的API，这个也是当时技术选型时选择的一个点，同时其基于UDP方式的Agent数据采集也比较符合个人的胃口。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>随着微服务的流行，传统的单体应用监控已经不能满足大规模分布式服务之间的问题定位，分布式跟踪刚好能解决这个问题，而Opentracing的出现统一了各个Tracer系统的接入标准，让开发者在选择的时候不用绑定在某一个厂商。由于tracing和monitoring在实现和用途上有一定的重叠，集tracing和monitoring的APM应该是该领域的一个趋势，这也是opencensus的一大优势。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/25/sakura/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/25/sakura/" itemprop="url">sakura</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-25T20:37:30+08:00">
                2018-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/生活轨迹/" itemprop="url" rel="index">
                    <span itemprop="name">生活轨迹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>10年前去过一次武汉大学，那会也没有特别的觉得樱花有多美，直到前两年去了一趟岛国，也是三月中下旬，再一次见到樱花，才发现她的美，可惜的是岛国樱花盛开期比武汉这边的晚，所以那次也没有看到盛开的场景，今天终于在樱花的盛开期近距离拍了几张，确实美，不愧为岛国国花。</p>
<p><img src="/images/2018/03/IMG_0130.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_7937.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_2237.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_3590.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_6728.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_9035.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_0267.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_1079.JPG" alt="樱花" title="sakura"><br><img src="/images/2018/03/IMG_2215.JPG" alt="樱花" title="sakura"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/19/boost-python/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/19/boost-python/" itemprop="url">boost.python</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-19T17:55:37+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近工作中使用到boost.python，感觉网上这方面的资料还是比较少，官方文档写的也不够详尽，算是做个备忘吧</p>
<pre><code>const char* greet()
{
    return &quot;hello,world&quot;;
}
// operator= for index

typedef std::vector&lt;int&gt; VI;
struct Foo
{
    int32_t a;
    std::string b;
    VI vi;
    bool operator==(Foo const&amp; f) const { return f.a == a; }
};

// A friendly class.
typedef std::vector&lt;Foo&gt; VecFoo;
class hello
{
public:
    hello(const std::string&amp; country) { this-&gt;country = country; }
    std::string greet() const { return &quot;Hello from &quot; + country; }
    Foo get_foo()const
    {
        Foo foo;
        foo.a = 123;
        foo.b = country;
        return foo;
    }
public:
    std::string country;
    VecFoo vf;
};

template &lt;typename T&gt;
struct VecConvert
{
    typedef std::vector&lt;T&gt; VecT;
    static PyObject* convert(const VecT&amp; vt)
    {
        boost::python::list pylist;
        for (auto&amp; t : vt)
        {
            pylist.append(t);
        }
        return boost::python::incref(pylist.ptr());
    }
};    
</code></pre><ul>
<li>导出函数及POD结构<pre><code>boost::python::def(&quot;greet&quot;, greet);
boost::python::class_&lt;Foo&gt;(&quot;Foo&quot;)
    .def_readwrite(&quot;a&quot;, &amp;Foo::a)
    .def_readwrite(&quot;b&quot;, &amp;Foo::b)
    .def_readwrite(&quot;vi&quot;, &amp;Foo::vi);
</code></pre></li>
<li>导出类<pre><code>boost::python::class_&lt;hello&gt;(&quot;hello&quot;, init&lt;std::string&gt;())
    // Add a regular member function.
    .def(&quot;greet&quot;, &amp;hello::greet)
    // Add invite() as a member of hello!
    .def(&quot;invite&quot;, invite)
    .def(&quot;get_foo&quot;, &amp;hello::get_foo)
    .def_readwrite(&quot;vf&quot;, &amp;hello::vf);  
</code></pre></li>
<li>导出容器<ol>
<li>导出一个新的容器类<pre><code>boost::python::class_&lt;VI&gt;(&quot;VI&quot;).def(boost::python::vector_indexing_suite&lt;VI&gt;());
</code></pre></li>
<li>直接转换为python的list<pre><code>boost::python::to_python_converter&lt;VI, VecConvert&lt;int&gt;&gt;();
</code></pre></li>
</ol>
</li>
<li>python list对象转换为c++ vector<pre><code>//c++
void setFoos(const boost::python::list&amp; pylist)
{
    std::vector&lt;Foo&gt; fs;
    for (int i =0; i&lt; boost::python::len(pylist); i++)
    {
        fs.push_back(boost::python::extract&lt;Foo&gt;(pylist[i]));
    }
}
boost::python::def(&quot;setFoos&quot;, setFoos);
//python
Foo f1,f2
setFoos([f1, f2])
</code></pre></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/11/software-engineering-advice-from-google/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/11/software-engineering-advice-from-google/" itemprop="url">software-engineering-advice-from-google</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-11T16:25:32+08:00">
                2017-11-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>google计算环境<ul>
<li>大量廉价PC组成的集群</li>
<li>新集群存在大量的硬件故障</li>
</ul>
</li>
<li>google工程环境<ul>
<li>分布式系统（数据或者请求都没法在一个机器上完成）</li>
<li>遍布全球的多个数据中心</li>
</ul>
</li>
<li>产品大都是服务，而不是简单包装的软件<ul>
<li>服务在内部也会大量</li>
<li>。。。</li>
</ul>
</li>
<li>设计软件系统需要各种平衡<ul>
<li>简单</li>
<li>扩展</li>
<li>性能</li>
<li>可靠性</li>
<li>通用性</li>
<li>专有性</li>
</ul>
</li>
<li>在编码和详细文档之前需要做的事情<ul>
<li>先做一个大致的设计</li>
<li>跟做过类似系统的人在白板上讨论</li>
<li>最好是讨论一些不同的可选设计</li>
</ul>
</li>
<li>接口<ul>
<li>接口需要仔细考虑</li>
<li>想象一下一些遗留的客户需要如何使用</li>
<li>精确的文档，但是要避免实现上的限制</li>
<li>在实现接口之前要注意反馈的意见</li>
<li>最好的学习方式是借鉴已有的优秀接口设计</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/05/2017-the-fisrt-tossing/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="billowqiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="taocoding">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/05/2017-the-fisrt-tossing/" itemprop="url">博客折腾记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-05T14:02:27+08:00">
                2017-02-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/未分类/" itemprop="url" rel="index">
                    <span itemprop="name">未分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<ul>
<li>第一阶段，刚接触Blog，觉得很新鲜，试着选择一个免费空间来写。</li>
<li>第二阶段，发现免费空间限制太多，就自己购买域名和空间，搭建独立博客。</li>
<li>第三阶段，觉得独立博客的管理太麻烦，最好在保留控制权的前提下，让别人来管，自己只负责写文章。</li>
</ul>
<hr>
<p>上面这段换摘抄自阮一峰的博客，有一种似曾相识的感觉：</p>
<ul>
<li>编程爱好者博客</li>
<li>百度Hi空间</li>
<li>CSDN </li>
<li>虚拟空间 </li>
<li>域名+虚拟空间 </li>
<li>域名+VPS </li>
<li>GitHub Pages+Hexo。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">billowqiu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">156</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/billowqiu" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:billowqiu@163.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">billowqiu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
